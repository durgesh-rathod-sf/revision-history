/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x2f8a06,PendingActions as _0x4b7d91}from'ckeditor5/src/core';import _0x463fa2 from'@ckeditor/ckeditor5-collaboration-core/src/users';import{LiveRange as _0x2dbd60}from'ckeditor5/src/engine';import{CKEditorError as _0x6684a1,uid as _0x17e38b,priorities as _0x8da7fc,EmitterMixin as _0x37c232,mix as _0x3e6840}from'ckeditor5/src/utils';import _0x2b993d from'@ckeditor/ckeditor5-comments/src/comments/commentsrepository';import _0x126243 from'./commands/trackchangescommand';import _0x506a57 from'./commands/acceptsuggestioncommand';import _0x4900ca from'./commands/discardsuggestioncommand';import _0x5535ee from'./commands/acceptallsuggestionscommand';import _0x2e6d55 from'./commands/acceptselectedsuggestionscommand';import _0x2a8010 from'./commands/discardallsuggestionscommand';import _0x49fbcd from'./commands/discardselectedsuggestionscommand';import _0xf23b9 from'./suggestion';import _0x23bbe5 from'./suggestiondescriptionfactory';import'../theme/suggestion.css';import'../theme/suggestionmarker.css';import _0x35184d from'./integrations/alignment';import _0x24f559 from'./integrations/basicstyles';import _0x5cee8b from'./integrations/blockquote';import _0x5c67f5 from'./integrations/codeblock';import _0x37befb from'./integrations/comments';import _0x4df444 from'./integrations/deletecommand';import _0x49d216 from'./integrations/entercommand';import _0x5d06e6 from'./integrations/font';import _0x2bc64d from'./integrations/heading';import _0x2bc3f8 from'./integrations/highlight';import _0x133b11 from'./integrations/horizontalline';import _0x289993 from'./integrations/image';import _0x1bf309 from'./integrations/indent';import _0x1a5409 from'./integrations/inputcommand';import _0xe3e460 from'./integrations/link';import tt from'./integrations/list';import it from'./integrations/mediaembed';import st from'./integrations/mention';import nt from'./integrations/pagebreak';import et from'./integrations/paragraph';import ot from'./integrations/removeformat';import rt from'./integrations/restrictededitingmode';import at from'./integrations/shiftentercommand';import ct from'./integrations/standardeditingmode';import ht from'./integrations/table';import ut from'./integrations/tablemergesplit';import ft from'./integrations/tableheadings';import gt from'./integrations/tableclipboard';import lt from'./integrations/title';import dt from'./integrations/undo';import mt from'./utils/hashobject.js';import{toWidget as pt}from'ckeditor5/src/widget';export default class l extends _0x2f8a06{static get['requires'](){return[_0x463fa2,_0x4b7d91,_0x2b993d,_0x35184d,_0x24f559,_0x5cee8b,_0x5c67f5,_0x37befb,_0x4df444,_0x49d216,_0x5d06e6,_0x2bc64d,_0x2bc3f8,_0x133b11,_0x289993,_0x1bf309,_0x1a5409,_0xe3e460,tt,it,st,nt,et,ot,rt,at,ct,ht,ut,ft,gt,lt,dt];}static get['pluginName'](){return'TrackChangesEditing';}constructor(_0x58aae7){function _0x1f7655(_0x3992a6){return _0x3992a6['map'](_0x1c53ac=>String['fromCharCode'](_0x1c53ac))['join']('');}super(_0x58aae7),this['set']('activeMarkers',[]),this['on']('change:activeMarkers',(_0x2959cf,_0x48b3d1,_0x1096f4,_0x5ee122)=>{this['_model']['change'](_0x1983e3=>{for(const _0x502847 of[..._0x5ee122,..._0x1096f4])this['_model']['markers']['has'](_0x502847)&&_0x1983e3['updateMarker'](_0x502847);});}),this['_descriptionFactory']=new _0x23bbe5(this['editor']['model']['schema'],this['editor']['locale']),this['_adapter']=null,this['_suggestionFactory']=new kt(this['editor']),this['_suggestions']=new Map(),this['_commentsRepository']=_0x58aae7['plugins']['get'](_0x2b993d),this['_enabledCommands']=new Set(),this['_model']=this['editor']['model'],this['_suggestionState']=new WeakMap(),this['_isForcedDefaultExecutionBlock']=!0x1,this[_0x1f7655([0x5f,0x65,0x78,0x65,0x63,0x75,0x74,0x65,0x53,0x75,0x67,0x67,0x65,0x73,0x74,0x69,0x6f,0x6e])]=_0x1f7655([0x34,0x30,0x34,0x34,0x30,0x32,0x36,0x32]);}['init'](){const _0x42fa62=this['editor'];_0x42fa62['conversion']['for']('editingDowncast')['markerToHighlight']({'model':'suggestion','view':_0x4ddf01=>{const {id:_0x1e90d9,type:_0x3fcc3d}=this['_splitMarkerName'](_0x4ddf01['markerName']),_0x53c230=['ck-suggestion-marker','ck-suggestion-marker-'+_0x3fcc3d];let _0x1815ad=0xbb8;return this['activeMarkers']['includes'](_0x4ddf01['markerName'])&&(_0x53c230['push']('ck-suggestion-marker--active'),_0x1815ad=0xbc2),'deletion'==_0x3fcc3d&&(_0x1815ad+=0x5),{'classes':_0x53c230,'attributes':{'data-suggestion':_0x1e90d9},'priority':_0x1815ad};}}),_0x42fa62['conversion']['for']('dataDowncast')['add'](_0x182082=>{_0x182082['on']('addMarker:suggestion',(_0x9e99d1,_0x241fa9,_0x38cc55)=>{if(!_0x38cc55['options']['showSuggestionHighlights'])return;const _0x3f09f5=_0x241fa9['item'];if(!_0x3f09f5)return;const _0x4ae082=_0x38cc55['mapper']['toViewElement'](_0x3f09f5);_0x42fa62['model']['schema']['isObject'](_0x3f09f5)&&_0x4ae082&&!_0x4ae082['getCustomProperty']('widget')&&_0x4ae082['is']('containerElement')&&pt(_0x4ae082,_0x38cc55['writer']);},{'priority':'high'});}),_0x42fa62['conversion']['for']('dataDowncast')['markerToHighlight']({'model':'suggestion','view':(_0x53cc57,_0x1b4798)=>{if(!_0x1b4798['options']['showSuggestionHighlights'])return null;const {type:_0x46ddb5}=this['_splitMarkerName'](_0x53cc57['markerName']);return{'classes':['ck-suggestion-marker','ck-suggestion-marker-'+_0x46ddb5],'priority':0xbb8};}});const _0x3bdd06=({showActiveMarkers:_0x59ff34=!0x0}={})=>(_0x24739e,_0x3231e1,_0x3f3f28)=>{if(!_0x3231e1['item'])return;if(_0x3231e1['item']['is']('selection'))return void _0x3f3f28['consumable']['consume'](_0x3231e1['item'],_0x24739e['name']);const _0xee5aa1=_0x3f3f28['mapper']['toViewElement'](_0x3231e1['item']);if(!(_0x3231e1['item']['is']('element')&&_0x42fa62['model']['schema']['isBlock'](_0x3231e1['item'])&&!_0xee5aa1['getCustomProperty']('addHighlight')))return;const {id:_0x2245e4}=this['_splitMarkerName'](_0x3231e1['markerName']);_0x3f3f28['writer']['addClass'](['ck-suggestion-marker','ck-suggestion-marker-formatBlock'],_0xee5aa1),_0x3f3f28['writer']['setAttribute']('data-suggestion',_0x2245e4,_0xee5aa1),_0x3f3f28['mapper']['bindElementToMarker'](_0xee5aa1,_0x3231e1['markerName']),_0x59ff34&&(this['activeMarkers']['includes'](_0x3231e1['markerName'])?_0x3f3f28['writer']['addClass']('ck-suggestion-marker--active',_0xee5aa1):_0x3f3f28['writer']['removeClass']('ck-suggestion-marker--active',_0xee5aa1));for(const _0x2383ce of _0x42fa62['model']['createRangeIn'](_0x3231e1['item'])['getItems']())_0x3f3f28['consumable']['consume'](_0x2383ce,_0x24739e['name']);_0x3f3f28['consumable']['consume'](_0x3231e1['item'],_0x24739e['name']);};_0x42fa62['conversion']['for']('dataDowncast')['add'](_0x27b4a8=>{_0x27b4a8['on']('addMarker:suggestion:formatBlock',(_0x5041ab,_0x290fd7,_0x27fa13)=>{_0x27fa13['options']['showSuggestionHighlights']&&_0x3bdd06({'showActiveMarkers':!0x1})(_0x5041ab,_0x290fd7,_0x27fa13);},{'priority':'highest'});}),_0x42fa62['conversion']['for']('dataDowncast')['markerToData']({'model':'suggestion','view':(_0x5b2b7d,_0x2f254d)=>_0x2f254d['options']['showSuggestionHighlights']?null:{'group':'suggestion','name':_0x5b2b7d['substr']('suggestion'['length']+0x1)}}),_0x42fa62['conversion']['for']('upcast')['elementToElement']({'view':{'name':'suggestion','attribute':{'id':/^\w/,'suggestionType':/^\w/}},'model':(_0x3a359f,{writer:_0x42d325})=>{let _0x27d6d3='suggestion:'+_0x3a359f['getAttribute']('suggestion-type')+':'+_0x3a359f['getAttribute']('id');return _0x3a359f['getAttribute']('marker-count')&&(_0x27d6d3+=':'+_0x3a359f['getAttribute']('marker-count')),_0x42d325['createElement']('$marker',{'data-name':_0x27d6d3});}}),_0x42fa62['conversion']['for']('upcast')['dataToMarker']({'view':'suggestion'}),_0x42fa62['conversion']['for']('editingDowncast')['add'](_0x50e4f3=>{_0x50e4f3['on']('addMarker:suggestion:formatBlock',_0x3bdd06(),{'priority':'high'});}),_0x42fa62['conversion']['for']('editingDowncast')['add'](_0xb1b1eb=>{_0xb1b1eb['on']('removeMarker:suggestion:formatBlock',(_0x1905eb,_0x4c05b7,_0x319004)=>{const _0x332c0f=_0x319004['mapper']['markerNameToElements'](_0x4c05b7['markerName']);if(_0x332c0f)for(const _0x4a1b14 of _0x332c0f)_0x4a1b14['getCustomProperty']('addHighlight')||(_0x319004['writer']['removeClass'](['ck-suggestion-marker','ck-suggestion-marker-formatBlock','ck-suggestion-marker--active'],_0x4a1b14),_0x319004['writer']['removeAttribute']('data-suggestion',_0x4a1b14),_0x319004['mapper']['unbindElementFromMarkerName'](_0x4a1b14,_0x4c05b7['markerName']));},{'priority':'high'});}),_0x42fa62['model']['document']['registerPostFixer'](_0x2a085d=>{let _0x3718de=!0x1;const _0x30d924=Array['from'](_0x42fa62['model']['document']['differ']['getChangedMarkers']());for(const {name:_0x4f28d7,data:_0x189727}of _0x30d924){const {group:_0xd7a53d,type:_0x40f83e,id:_0x2f8ab2}=this['_splitMarkerName'](_0x4f28d7);if('suggestion'!==_0xd7a53d)continue;const _0x159c60=this['_suggestions']['get'](_0x2f8ab2);if(null!=_0x189727['newRange']){'formatInline'==_0x40f83e&&(_0x3718de=_0x3718de||St(_0x189727['newRange'],_0x4f28d7,_0x2a085d,_0x42fa62['model']['schema']));if(_0x189727['newRange']['isCollapsed']||'$graveyard'==_0x189727['newRange']['root']['rootName']||'formatBlock'==_0x40f83e&&!It(_0x189727['newRange'])||'deletion'==_0x40f83e&&!(!yt(_0x247bf3=_0x189727['newRange'])&&!function(_0x2f05a7){return _0x2f05a7['start']['parent']==_0x2f05a7['end']['nodeBefore']&&_0x2f05a7['start']['isAtEnd'];}(_0x247bf3)))_0x2a085d['removeMarker'](_0x4f28d7),_0x3718de=!0x0;else{if(!_0x159c60||!_0x159c60['isInContent'])continue;_0x3718de=!!this['_joinWithAdjacentSuggestions'](_0x159c60)||_0x3718de;}}}var _0x247bf3;return _0x3718de;}),_0x42fa62['model']['document']['registerPostFixer'](_0x51e6d9=>{let _0x122d05=!0x1;for(const _0x2fc011 of _0x42fa62['model']['document']['differ']['getChanges']()){if('insert'!=_0x2fc011['type'])continue;const _0x9db5b0=_0x2fc011['position']['getShiftedBy'](_0x2fc011['length']);if(_0x9db5b0['isAtEnd'])for(const _0x11eba9 of this['_suggestions']['values']()){if(_0x11eba9['isMultiRange']||!_0x11eba9['isInContent'])continue;if('formatBlock'!=_0x11eba9['type'])continue;const _0x5e4f30=_0x11eba9['getFirstRange']();if(_0x5e4f30['start']['parent']!=_0x5e4f30['end']['parent']&&_0x5e4f30['end']['isEqual'](_0x2fc011['position'])){const _0x518327=_0x42fa62['model']['createRange'](_0x5e4f30['start'],_0x9db5b0);_0x51e6d9['updateMarker'](_0x11eba9['getFirstMarker'](),{'range':_0x518327}),_0x122d05=!0x0;}}}return _0x122d05;}),_0x42fa62['model']['markers']['on']('update:suggestion',(_0x4c6dd9,_0x5477d7,_0x35332e)=>{if(null==_0x35332e){const {id:_0x38ab35}=this['_splitMarkerName'](_0x5477d7['name']),_0x436a96=this['_suggestions']['get'](_0x38ab35);_0x436a96&&_0x436a96['addMarkerName'](_0x5477d7['name']);}}),_0x42fa62['model']['document']['on']('change:data',()=>{const _0x4be4d2=Array['from'](_0x42fa62['model']['document']['differ']['getChangedMarkers']());_0x4be4d2['sort']((_0x5dd3e0,_0xb9cb51)=>{const _0x9ee2df=_0x5dd3e0['data']['oldRange'],_0x195be8=_0xb9cb51['data']['oldRange'];return null===_0x9ee2df&&null===_0x195be8?0x0:null===_0x9ee2df&&null!==_0x195be8?-0x1:null!==_0x9ee2df&&null===_0x195be8?0x1:_0x9ee2df['start']['isBefore'](_0x195be8['start'])?-0x1:0x1;});const _0x40c04f=new Set();for(const {name:_0x4b7797,data:_0x2eea5d}of _0x4be4d2){const {group:_0x29cf6a,id:_0x12f46d}=this['_splitMarkerName'](_0x4b7797);if('suggestion'===_0x29cf6a&&(null===_0x2eea5d['oldRange']&&this['_handleNewSuggestionMarker'](_0x4b7797),null===_0x2eea5d['newRange'])){const _0x3ab62a=this['_suggestions']['get'](_0x12f46d);_0x3ab62a['isInContent']?_0x40c04f['add'](_0x3ab62a):this['_removeSuggestion'](_0x3ab62a);}}for(const {name:_0x15b152,data:_0x63b77d}of _0x4be4d2){const {group:_0x5edc6e,id:_0x1194f2}=this['_splitMarkerName'](_0x15b152);if('suggestion'!==_0x5edc6e)continue;const _0x5b4681=this['_suggestions']['get'](_0x1194f2);null!=_0x63b77d['newRange']&&null!=_0x63b77d['oldRange']&&(this['_refreshSuggestionsChain'](_0x5b4681),_0x40c04f['add'](_0x5b4681['head']));}for(const _0x2b9e16 of _0x40c04f)this['fire']('suggestionChanged',_0x2b9e16);_0x40c04f['clear']();}),_0x42fa62['model']['on']('applyOperation',(_0x4b773f,_0x21e4ac)=>{const _0x3a48cd=_0x21e4ac[0x0];if(!this['_suggestions']['size'])return;if(!_0x3a48cd['isDocumentOperation'])return;if(_0x3a48cd['batch']['isUndo']||!_0x3a48cd['batch']['isLocal'])return;let _0x2133f9,_0x3b4791;switch(_0x3a48cd['type']){case'insert':_0x2133f9=_0x42fa62['model']['createPositionAt'](_0x3a48cd['position']),_0x3b4791=_0x2133f9['getShiftedBy'](_0x3a48cd['howMany']);break;case'split':_0x2133f9=_0x42fa62['model']['createPositionAt'](_0x3a48cd['splitPosition']),_0x3b4791=_0x42fa62['model']['createPositionAt'](_0x3a48cd['moveTargetPosition']);break;case'move':_0x2133f9=_0x42fa62['model']['createPositionAt'](_0x3a48cd['targetPosition']),_0x3b4791=_0x2133f9['getShiftedBy'](_0x3a48cd['howMany']);break;default:return;}const _0xc4e2eb=_0x42fa62['model']['createRange'](_0x2133f9,_0x3b4791);_0x42fa62['model']['change'](()=>{for(const {suggestion:_0x1019f3,meta:_0x2676a9}of this['_findSuggestions'](_0xc4e2eb)){if(_0x1019f3['isMultiRange'])continue;if('formatInline'==_0x1019f3['type'])continue;const _0xd1fa6d=_0x1019f3['data']&&_0x1019f3['data']['multipleBlocks'];('formatBlock'!=_0x1019f3['type']||'split'==_0x3a48cd['type']&&!_0xd1fa6d)&&(_0x2676a9['containsRangeInObject']||'insertion'==_0x1019f3['type']&&_0x2676a9['isOwn']||_0x1019f3['getFirstRange']()['containsRange'](_0xc4e2eb)&&this['_breakSuggestionMarker'](_0x1019f3,_0x2133f9,_0x3b4791));}});},{'priority':'lowest'}),_0x42fa62['model']['on']('deleteContent',(_0x237ac1,_0xd84a44)=>{const _0x53ee51=_0xd84a44[0x0],_0x3a8e55=_0xd84a44[0x1];if(_0x3a8e55&&_0x3a8e55['forceDefaultExecution'])return;if(this['_isForcedDefaultExecutionBlock'])return;if(!this['trackChangesCommand']['value'])return;if(_0x53ee51['isCollapsed'])return;const _0x37f76e=_0x42fa62['model']['schema'],{start:_0x3d99f5,end:_0x53db90}=_0x53ee51['getFirstRange'](),_0x4bc695=_0x3d99f5['nodeAfter']&&_0x37f76e['isObject'](_0x3d99f5['nodeAfter'])?null:_0x37f76e['getNearestSelectionRange'](_0x3d99f5,'forward'),_0x3f4307=_0x53db90['nodeBefore']&&_0x37f76e['isObject'](_0x53db90['nodeBefore'])?null:_0x37f76e['getNearestSelectionRange'](_0x53db90,'backward'),_0x2a6674=_0x42fa62['model']['createRange'](_0x4bc695?_0x4bc695['start']:_0x3d99f5,_0x3f4307?_0x3f4307['end']:_0x53db90);_0x42fa62['model']['change'](_0x33bce3=>{this['markDeletion'](_0x2a6674);const _0x3bf743=_0x42fa62['model']['schema']['getNearestSelectionRange'](_0x2a6674['start']);_0x53ee51['is']('documentSelection')?_0x33bce3['setSelection'](_0x3bf743):_0x53ee51['setTo'](_0x3bf743);}),_0x237ac1['stop']();},{'priority':_0x8da7fc['normal']+0xa}),_0x42fa62['model']['on']('insertContent',(_0x10c195,_0x377067)=>{const _0x4aa63b=_0x377067[_0x377067['length']-0x1];_0x4aa63b&&_0x4aa63b['forceDefaultExecution']||this['_isForcedDefaultExecutionBlock']||this['trackChangesCommand']['value']&&(_0x42fa62['model']['change'](()=>{let _0x4882f8=_0x42fa62['model']['insertContent'](_0x377067[0x0],_0x377067[0x1],_0x377067[0x2],_0x377067[0x3],{'forceDefaultExecution':!0x0});if(!_0x4882f8)return;_0x10c195['return']=_0x4882f8['clone']();const _0x38de2c=_0x4882f8['end']['nodeBefore'],_0x41f8c1=_0x42fa62['model']['schema'];_0x38de2c&&_0x41f8c1['isBlock'](_0x38de2c)&&!_0x41f8c1['isObject'](_0x38de2c)&&(_0x4882f8=_0x42fa62['model']['createRange'](_0x4882f8['start'],_0x42fa62['model']['createPositionAt'](_0x38de2c,'end'))),this['markInsertion'](_0x4882f8);}),_0x10c195['stop']());},{'priority':'high'}),this['trackChangesCommand']=new _0x126243(_0x42fa62,this['_enabledCommands']),this['editor']['commands']['add']('trackChanges',this['trackChangesCommand']),this['enableCommand']('trackChanges');const _0x21faf8=new _0x506a57(_0x42fa62,this['_suggestions']);_0x42fa62['commands']['add']('acceptSuggestion',_0x21faf8),this['enableCommand']('acceptSuggestion');const _0x24f027=new _0x4900ca(_0x42fa62,this['_suggestions']);_0x42fa62['commands']['add']('discardSuggestion',_0x24f027),this['enableCommand']('discardSuggestion'),_0x42fa62['commands']['add']('acceptAllSuggestions',new _0x5535ee(_0x42fa62,_0x21faf8,this['_suggestions'])),this['enableCommand']('acceptAllSuggestions'),_0x42fa62['commands']['add']('discardAllSuggestions',new _0x2a8010(_0x42fa62,_0x24f027,this['_suggestions'])),this['enableCommand']('discardAllSuggestions'),_0x42fa62['commands']['add']('acceptSelectedSuggestions',new _0x2e6d55(_0x42fa62,_0x21faf8,this['_suggestions'])),this['enableCommand']('acceptSelectedSuggestions'),_0x42fa62['commands']['add']('discardSelectedSuggestions',new _0x49fbcd(_0x42fa62,_0x24f027,this['_suggestions'])),this['enableCommand']('discardSelectedSuggestions');const _0x4bfc61=_0x42fa62['plugins']['get'](_0x2b993d);this['listenTo'](_0x4bfc61,'addComment',(_0x39d0df,{threadId:_0x29eea8})=>{const _0x4a7729=this['_suggestions']['get'](_0x29eea8);_0x4a7729&&_0x4a7729['commentThread']&&0x1===_0x4a7729['commentThread']['length']&&this['_updateSuggestionData'](_0x29eea8,{'hasComments':!0x0});},{'priority':'low'}),this['listenTo'](_0x4bfc61,'removeComment',(_0x594514,{threadId:_0x3b18b7})=>{const _0x41f2e1=this['_suggestions']['get'](_0x3b18b7);_0x41f2e1&&_0x41f2e1['commentThread']&&!_0x41f2e1['commentThread']['length']&&this['_updateSuggestionData'](_0x3b18b7,{'hasComments':!0x1});},{'priority':'low'});}set['adapter'](_0x5d709d){if(this['_adapter'])throw new _0x6684a1('track-changes-adapter-already-set',this);this['_adapter']=_0x5d709d;}get['adapter'](){return this['_adapter'];}['getSuggestions']({skipNotAttached:_0x1a1236=!0x1,toJSON:_0x2ed47e=!0x1}={}){const _0x466e4c=[];for(const _0x523cf1 of this['_suggestions']['values']())_0x1a1236&&!_0x523cf1['isInContent']||_0x466e4c['push'](_0x523cf1);return _0x2ed47e?_0x466e4c['map'](_0x37df42=>_0x37df42['toJSON']()):_0x466e4c;}['getSuggestion'](_0x36dd8c){const _0x516fbe=this['_suggestions']['get'](_0x36dd8c);if(!_0x516fbe)throw new _0x6684a1('track-changes-suggestion-not-found',this);return _0x516fbe;}['hasSuggestion'](_0x12dcf5){return this['_suggestions']['has'](_0x12dcf5);}['addSuggestionData'](_0x58dd29){const {id:_0x3a7e16,authorId:_0x2de73e}=_0x58dd29,[_0x8caa16,_0x4bac32]=_0x58dd29['type']['split'](':'),_0x1521a0=this['_suggestions']['get'](_0x3a7e16)||this['_createSuggestion'](_0x8caa16,_0x4bac32,_0x3a7e16,_0x2de73e);switch(this['_addThreadToSuggestion'](_0x1521a0),this['_checkSuggestionCorrectness'](_0x1521a0,_0x8caa16,_0x4bac32||null,_0x2de73e),_0x1521a0['createdAt']=_0x58dd29['createdAt'],_0x58dd29['data']&&(_0x1521a0['data']=_0x58dd29['data']),_0x58dd29['attributes']&&(_0x1521a0['attributes']=_0x58dd29['attributes']),this['_adapter']&&this['_adapter']['addSuggestion']||(_0x1521a0['_saved']=!0x0),this['_suggestionState']['get'](_0x1521a0)){case'notReady':this['_suggestionState']['set'](_0x1521a0,'dataReady');break;case'markerReady':_0x1521a0['isInContent']?(this['_suggestionState']['set'](_0x1521a0,'ready'),this['fire']('suggestionLoaded',_0x1521a0)):this['_suggestionState']['set'](_0x1521a0,'removed');}return _0x1521a0;}['acceptSuggestion'](_0x407621){this['forceDefaultExecution'](()=>{this['editor']['model']['change'](()=>{for(const _0x5a6d15 of _0x407621['getAllAdjacentSuggestions']())_0x5a6d15['accept']();});});}['discardSuggestion'](_0x47fdbe){this['forceDefaultExecution'](()=>{this['editor']['model']['change'](()=>{for(const _0xbe55e2 of _0x47fdbe['getAllAdjacentSuggestions']())_0xbe55e2['discard']();});});}['enableCommand'](_0x40631a,_0x192cc8){const _0x39aa2b=this['editor']['commands']['get'](_0x40631a);if(!_0x39aa2b)throw new _0x6684a1('track-changes-command-not-found',this,{'commandName':_0x40631a});this['_enabledCommands']['add'](_0x39aa2b),_0x192cc8&&_0x39aa2b['on']('execute',(_0x4c361c,_0x2ff267)=>{this['trackChangesCommand']['value']&&(this['_isForcedDefaultExecutionBlock']||_0x2ff267['length']>0x0&&_0x2ff267[_0x2ff267['length']-0x1]&&_0x2ff267[_0x2ff267['length']-0x1]['forceDefaultExecution']||(_0x192cc8((..._0x5ade1a)=>_0x39aa2b['execute'](..._0x5ade1a,{'forceDefaultExecution':!0x0}),..._0x2ff267),_0x4c361c['stop']()));},{'priority':'high'});}['forceDefaultExecution'](_0x479767){let _0x55409f,_0x518c0c;const _0x4bb145=this['_isForcedDefaultExecutionBlock'];this['_isForcedDefaultExecutionBlock']=!0x0;try{_0x55409f=_0x479767();}catch(_0x7049a3){_0x518c0c=_0x7049a3;}return _0x4bb145||(this['_isForcedDefaultExecutionBlock']=!0x1),_0x518c0c&&_0x6684a1['rethrowUnexpectedError'](_0x518c0c,this),_0x55409f;}['markInsertion'](_0x5a790e,_0x17208d=null,_0xfca3bc={}){if(_0x5a790e['isCollapsed'])return null;const _0x4b4331=this['editor']['plugins']['get']('Users')['me'];for(const {suggestion:_0x30aae4,meta:_0x76902a}of this['_findSuggestions'](_0x5a790e,'insertion'))if(_0x76902a['isOwn']){if(!_0x76902a['isNextTo'])return _0x30aae4;if(_0x17208d==_0x30aae4['subType']){const _0x1d35d7=_0x30aae4['getFirstRange']();return _0x1d35d7['start']['isEqual'](_0x5a790e['end'])?this['_setSuggestionRange'](_0x30aae4,this['_model']['createRange'](_0x5a790e['start'],_0x1d35d7['end'])):this['_setSuggestionRange'](_0x30aae4,this['_model']['createRange'](_0x1d35d7['start'],_0x5a790e['end'])),_0x30aae4;}}const _0x552a9f=_0x17e38b(),_0x5f40ad=_0x4b4331['id'],_0xc0ddbd=_0x17208d?'insertion:'+_0x17208d:'insertion',_0x1021a9=this['_setSuggestionData']({'id':_0x552a9f,'type':_0xc0ddbd,'createdAt':new Date(),'authorId':_0x5f40ad,'attributes':_0xfca3bc});return this['_addSuggestionMarker'](_0xc0ddbd,_0x552a9f,_0x5f40ad,_0x5a790e),_0x1021a9;}['markMultiRangeInsertion'](_0x59e029,_0x34380b='multi',_0x8c0762={}){const _0x44448a=this['editor']['plugins']['get']('Users')['me'],_0x2d681a=this['_suggestionFactory']['getSuggestionCallback']('insertion',_0x34380b,'join');for(const _0x23df7f of this['getSuggestions']())if(_0x23df7f['author']['id']==_0x44448a['id']&&'insertion'==_0x23df7f['type']&&_0x23df7f['subType']==_0x34380b&&(_0x2d681a(_0x23df7f['getRanges'](),_0x59e029)||_0x2d681a(_0x59e029,_0x23df7f['getRanges']()))){for(const _0x32c6a of _0x59e029)_0x23df7f['addRange'](_0x32c6a);return _0x23df7f;}for(const _0x8cf6c2 of _0x59e029)for(const {suggestion:_0x26c12a,meta:_0x3671ae}of this['_findSuggestions'](_0x8cf6c2,'insertion')){if(!_0x3671ae['isOwn'])continue;let _0x2773b7=!0x0;for(const _0x4b1e4a of _0x26c12a['getRanges']())for(const _0x33cab0 of _0x59e029)if(!_0x4b1e4a['containsRange'](_0x33cab0)){_0x2773b7=!0x1;break;}if(_0x2773b7)return _0x26c12a;}const _0x123618=_0x17e38b(),_0x3c007e=_0x44448a['id'],_0x468956='insertion:'+_0x34380b,_0x280e99=this['_setSuggestionData']({'id':_0x123618,'type':_0x468956,'createdAt':new Date(),'authorId':_0x3c007e,'attributes':_0x8c0762});for(const _0x2c13a2 of _0x59e029)this['_addSuggestionMarker'](_0x468956,_0x123618,_0x3c007e,_0x2c13a2,_0xf23b9['getMultiRangeId']());return _0x280e99;}['markInlineFormat'](_0x23bf4f,_0x5c4c0e,_0x49c25d=null,_0x3f8b2d={}){if(_0x49c25d=_0x49c25d||bt(_0x5c4c0e),_0x23bf4f['isCollapsed'])return;const _0x333777=this['editor']['plugins']['get']('Users')['me'],_0x2cb0c3=[];for(const {suggestion:_0x23bc7a,meta:_0x527527}of this['_findSuggestions'](_0x23bf4f,'insertion'))_0x527527['isOwn']&&!_0x527527['isInsideObject']&&_0x2cb0c3['push'](..._0x23bc7a['getRanges']());const _0x3e33ab=function(_0x3253a0,_0x2943ea){const _0x53936e=[];for(const _0x301c0c of _0x2943ea){const _0x51642e=_0x3253a0['getIntersection'](_0x301c0c);_0x51642e&&_0x53936e['push'](_0x51642e);}return _0x53936e;}(_0x23bf4f,_0x2cb0c3),_0x20267b=function(_0x376b0f,_0x32c782){const _0x367be1=[_0x376b0f];for(const _0x2f4ba4 of _0x32c782){let _0x57f184=0x0;for(;_0x57f184<_0x367be1['length'];){const _0x2eb06f=_0x367be1[_0x57f184]['getDifference'](_0x2f4ba4);_0x367be1['splice'](_0x57f184,0x1,..._0x2eb06f),_0x57f184+=_0x2eb06f['length'];}}return _0x367be1;}(_0x23bf4f,_0x2cb0c3);_0x3e33ab['length']&&this['_model']['change'](()=>{for(const _0x42813c of _0x3e33ab){const _0xdf07c1=this['_suggestionFactory']['getSuggestionCallback']('formatInline',_0x49c25d,'accept');this['forceDefaultExecution'](()=>_0xdf07c1([_0x42813c],_0x5c4c0e,_0x3f8b2d));}});for(const _0x39ac39 of _0x20267b){let _0x1d60fd=null,_0x92935c=_0x39ac39['start'],_0x449ff7=_0x39ac39['end'];for(const {suggestion:_0x4c298b,meta:_0xa8d47d}of this['_findSuggestions'](_0x39ac39,'formatInline')){if(!_0xa8d47d['isOwn'])continue;if(_0x4c298b['subType']!=_0x49c25d)continue;const _0x137dfd=_0x4c298b['getFirstRange']();if(_0x137dfd['containsRange'](_0x39ac39,!0x0))return;_0x92935c=_0x92935c['isBefore'](_0x137dfd['start'])?_0x92935c:_0x137dfd['start'],_0x449ff7=_0x449ff7['isAfter'](_0x137dfd['end'])?_0x449ff7:_0x137dfd['end'],_0x1d60fd?_0x137dfd['start']['isBefore'](_0x1d60fd['getFirstRange']()['start'])?(_0x1d60fd['removeMarkers'](),_0x1d60fd=_0x4c298b):_0x4c298b['removeMarkers']():_0x1d60fd=_0x4c298b;}const _0x287cc7=this['_model']['createRange'](_0x92935c,_0x449ff7);if(_0x1d60fd)this['_setSuggestionRange'](_0x1d60fd,_0x287cc7);else{const _0x1eb230=_0x17e38b(),_0x50cb2b=_0x333777['id'];this['_setSuggestionData']({'id':_0x1eb230,'type':'formatInline:'+_0x49c25d,'data':_0x5c4c0e,'createdAt':new Date(),'authorId':_0x50cb2b,'attributes':_0x3f8b2d}),this['_addSuggestionMarker']('formatInline:'+_0x49c25d,_0x1eb230,_0x50cb2b,_0x287cc7);}}}['markBlockFormat'](_0xb62f15,_0x1240d9,_0x15c34b=[],_0xde4303=null,_0x1cdb94={}){_0x1240d9['formatGroupId']||(_0x1240d9['formatGroupId']=_0x1240d9['commandName']),_0x1240d9['multipleBlocks']=_0xb62f15['is']('range'),_0xde4303=_0xde4303||bt(_0x1240d9);const _0x44e1fb=_0x15c34b['map'](_0x1ebb4e=>vt(_0x1ebb4e,this['_model'])),_0x5d6689=_0xb62f15['is']('range')?_0xb62f15:vt(_0xb62f15,this['_model']);_0x44e1fb['push'](_0x5d6689);let _0x4718c6=!0x0;for(const _0x2fa1aa of _0x44e1fb)if(!this['_rangeIsInLocalUserInsertion'](_0x2fa1aa)){_0x4718c6=!0x1;break;}if(_0x4718c6){const _0x52e5b6=this['_suggestionFactory']['getSuggestionCallback']('formatBlock',_0xde4303,'accept');return void this['forceDefaultExecution'](()=>_0x52e5b6([_0x5d6689],_0x1240d9,_0x1cdb94));}let _0x56b8b1=null,_0x1832d1=_0x5d6689['start'],_0x24ab53=_0x5d6689['end'];for(const {suggestion:_0x1d2611,meta:_0x3ca441}of this['_findSuggestions'](_0x5d6689,'formatBlock')){if(!_0x3ca441['isOwn']||_0x3ca441['isNextTo']||_0x3ca441['containsRangeInObject']||_0x3ca441['isInsideObject'])continue;if(_0x1d2611['data']['formatGroupId']!=_0x1240d9['formatGroupId'])continue;const _0x293a80=_0x1d2611['getFirstRange']();if(_0x1d2611['subType']==_0xde4303){if(_0x293a80['containsRange'](_0x5d6689,!0x0))return;_0x1832d1=_0x1832d1['isBefore'](_0x293a80['start'])?_0x1832d1:_0x293a80['start'],_0x24ab53=_0x24ab53['isAfter'](_0x293a80['end'])?_0x24ab53:_0x293a80['end'],_0x56b8b1?_0x293a80['start']['isBefore'](_0x56b8b1['getFirstRange']()['start'])?(_0x56b8b1['removeMarkers'](),_0x56b8b1=_0x1d2611):_0x1d2611['removeMarkers']():_0x56b8b1=_0x1d2611;}else{const _0x24804c=_0x5d6689['getIntersection'](_0x293a80);this['_cutOutSuggestionMarker'](_0x1d2611,_0x24804c);}}const _0x222713=this['editor']['plugins']['get']('Users')['me'],_0x34fc9b=_0x17e38b(),_0x2feb2a=_0x222713['id'];_0x56b8b1?this['_setSuggestionRange'](_0x56b8b1,this['_model']['createRange'](_0x1832d1,_0x24ab53)):(this['_setSuggestionData']({'id':_0x34fc9b,'type':'formatBlock:'+_0xde4303,'data':_0x1240d9,'createdAt':new Date(),'authorId':_0x2feb2a,'attributes':_0x1cdb94}),this['_addSuggestionMarker']('formatBlock:'+_0xde4303,_0x34fc9b,_0x2feb2a,this['_model']['createRange'](_0x1832d1,_0x24ab53)));}['markMultiRangeBlockFormat'](_0x533f3c,_0xd40695,_0x587f9c=[],_0x104a8e=null,_0x39b7d5={}){_0xd40695['formatGroupId']||(_0xd40695['formatGroupId']=_0xd40695['commandName']),_0xd40695['multipleBlocks']=!0x1,_0x104a8e=_0x104a8e||bt(_0xd40695);const _0x54c478=_0x587f9c['map'](_0x17eb1c=>vt(_0x17eb1c,this['_model'])),_0x4dad25=_0x533f3c['map'](_0x5b7203=>vt(_0x5b7203,this['_model']));_0x54c478['push'](..._0x4dad25);let _0x4ff165=!0x0;for(const _0x4c5b58 of _0x54c478)if(!this['_rangeIsInLocalUserInsertion'](_0x4c5b58)){_0x4ff165=!0x1;break;}if(_0x4ff165){const _0x15e887=this['_suggestionFactory']['getSuggestionCallback']('formatBlock',_0x104a8e,'accept');return void this['forceDefaultExecution'](()=>_0x15e887(_0x4dad25,_0xd40695,_0x39b7d5));}const _0x5d4a32=this['editor']['plugins']['get']('Users')['me'];for(const _0x17a37a of this['getSuggestions']()){if(_0x17a37a['author']['id']!=_0x5d4a32['id'])continue;if('formatBlock'!=_0x17a37a['type']||_0x17a37a['data']['formatGroupId']!=_0xd40695['formatGroupId'])continue;const _0x48e720=_0x17a37a['subType']==_0x104a8e;for(let _0x344715=0x0;_0x344715<_0x4dad25['length'];_0x344715++){const _0x2303e1=_0x4dad25[_0x344715];for(const _0x4609a6 of _0x17a37a['getMarkers']()){const _0x48099d=_0x4609a6['getRange']();if(_0x2303e1['isEqual'](_0x48099d)){_0x48e720?(_0x4dad25['splice'](_0x344715,0x1),_0x344715--):_0x17a37a['removeMarker'](_0x4609a6['name']);break;}}}}if(0x0==_0x4dad25['length'])return;const _0x180430=this['_suggestionFactory']['getSuggestionCallback']('formatBlock',_0x104a8e,'join');for(const _0x4966d1 of this['getSuggestions']())if(_0x4966d1['author']['id']==_0x5d4a32['id']&&'formatBlock'==_0x4966d1['type']&&_0x4966d1['data']['formatGroupId']==_0xd40695['formatGroupId']&&_0x4966d1['subType']==_0x104a8e&&(_0x180430(_0x4966d1['getRanges'](),_0x4dad25)||_0x180430(_0x4dad25,_0x4966d1['getRanges']()))){for(const _0x2ebaa0 of _0x4dad25)_0x4966d1['addRange'](_0x2ebaa0);return _0x4966d1;}const _0x4f60a2=_0x17e38b(),_0x51598f=_0x5d4a32['id'],_0x51a8e2='formatBlock:'+_0x104a8e,_0x24e3cf=this['_setSuggestionData']({'id':_0x4f60a2,'type':_0x51a8e2,'data':_0xd40695,'createdAt':new Date(),'authorId':_0x51598f,'attributes':_0x39b7d5});for(const _0x3397fd of _0x4dad25)this['_addSuggestionMarker'](_0x51a8e2,_0x4f60a2,_0x51598f,_0x3397fd,_0xf23b9['getMultiRangeId']());return _0x24e3cf;}['markDeletion'](_0x232ba9,_0x45f6f2=null,_0x4b39f7={}){if(_0x232ba9['isCollapsed'])return null;const _0x1fd91e=this['editor']['plugins']['get']('Users')['me'],_0x363480=new _0x2dbd60(_0x232ba9['start'],_0x232ba9['end']);for(const {suggestion:_0x1183a1,meta:_0x440adc}of this['_findSuggestions'](_0x363480,'insertion'))if(_0x440adc['isOwn']&&!_0x440adc['isNextTo']){if(_0x1183a1['isMultiRange']){const _0x1e35c8=_0x1183a1['getRanges']()['filter'](_0x479d72=>'$graveyard'!=_0x479d72['root']['rootName']);_0x1e35c8['every'](_0x193912=>_0x363480['containsRange'](_0x193912,!0x0))&&_0x1183a1['discard']();if(_0x1e35c8['some'](_0x170a5d=>_0x170a5d['containsRange'](_0x363480,!0x0))){const _0x21c294=this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x45f6f2,'accept');return this['forceDefaultExecution'](()=>_0x21c294([_0x363480],null,_0x4b39f7)),null;}}else{const _0x2fdf31=_0x363480['getIntersection'](_0x1183a1['getFirstRange']());_0x1183a1['_onDiscard']([_0x2fdf31],null,_0x4b39f7);}}if(_0x363480['detach'](),_0x363480['isCollapsed']||'$graveyard'==_0x363480['root']['rootName'])return null;let _0x170491=null,_0x39d46a=_0x363480['start'],_0x59ca7a=_0x363480['end'];for(const {suggestion:_0x2c268a,meta:_0x53eb9d}of this['_findSuggestions'](_0x363480,'deletion'))if(_0x53eb9d['isOwn']){if(_0x2c268a['isMultiRange']){let _0xcc17e2=!0x0;for(const _0x5ce8ff of _0x2c268a['getRanges']()){if(_0x5ce8ff['containsRange'](_0x363480,!0x0))return _0x2c268a;_0x363480['containsRange'](_0x5ce8ff)||(_0xcc17e2=!0x1);}_0xcc17e2&&_0x2c268a['discard']();}else{const _0x40092b=_0x2c268a['getFirstRange']();if(_0x40092b['containsRange'](_0x363480,!0x0))return _0x2c268a;_0x39d46a=_0x39d46a['isBefore'](_0x40092b['start'])?_0x39d46a:_0x40092b['start'],_0x59ca7a=_0x59ca7a['isAfter'](_0x40092b['end'])?_0x59ca7a:_0x40092b['end'],_0x170491?_0x40092b['start']['isBefore'](_0x170491['getFirstRange']()['start'])?(_0x170491['removeMarkers'](),_0x170491=_0x2c268a):_0x2c268a['removeMarkers']():_0x170491=_0x2c268a;}}if(_0x170491)return this['_setSuggestionRange'](_0x170491,this['_model']['createRange'](_0x39d46a,_0x59ca7a)),_0x170491;{const _0x242dd4=_0x17e38b(),_0x44aba6=this['_model']['createRange'](_0x39d46a,_0x59ca7a),_0x4c1797=_0x1fd91e['id'],_0x2abb58=_0x45f6f2?'deletion:'+_0x45f6f2:'deletion',_0x19fb77=this['_setSuggestionData']({'id':_0x242dd4,'type':_0x2abb58,'createdAt':new Date(),'authorId':_0x4c1797,'attributes':_0x4b39f7});return this['_addSuggestionMarker'](_0x2abb58,_0x242dd4,_0x4c1797,_0x44aba6),_0x19fb77;}}['markMultiRangeDeletion'](_0x44e7c5,_0x50b54a='multi',_0x173c9d={}){const _0x1e9a9c=this['editor']['plugins']['get']('Users')['me'],_0x1fec1c=_0x44e7c5['map'](_0x34e15f=>new _0x2dbd60(_0x34e15f['start'],_0x34e15f['end'])),_0x3e17bf=new Set();for(const _0x4f874a of _0x1fec1c)for(const {suggestion:_0x8aae87,meta:_0x281434}of this['_findSuggestions'](_0x4f874a,'insertion'))_0x281434['isOwn']&&!_0x281434['isNextTo']&&_0x3e17bf['add'](_0x8aae87);for(const _0xc8fba2 of _0x3e17bf)if(_0xc8fba2['isMultiRange']){const _0x3cc98c=_0xc8fba2['getRanges']();(!_0xc8fba2['attributes']||!_0xc8fba2['attributes']['skipNestingCheck'])&&(_0x3cc98c['every'](_0x4a1df0=>_0x1fec1c['some'](_0x4a1c61=>_0x4a1c61['containsRange'](_0x4a1df0,!0x0)))&&_0xc8fba2['discard']());if(_0x1fec1c['every'](_0x53509=>_0x3cc98c['some'](_0x2247f2=>_0x2247f2['containsRange'](_0x53509,!0x0)))){const _0x48cbf5=this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x50b54a,'accept');return this['forceDefaultExecution'](()=>_0x48cbf5(_0x44e7c5,null,_0x173c9d)),null;}}else{const _0x5431c8=_0xc8fba2['getFirstRange']();_0x1fec1c['some'](_0x34cfcb=>_0x34cfcb['containsRange'](_0x5431c8,!0x0))&&_0xc8fba2['discard']();if(_0x1fec1c['every'](_0x340f1e=>_0x5431c8['containsRange'](_0x340f1e,!0x0))){const _0x47288b=this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x50b54a,'accept');return this['forceDefaultExecution'](()=>_0x47288b(_0x1fec1c,null,_0x173c9d)),null;}}const _0x1f878b=this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x50b54a,'join');let _0x1ce7db=null;for(const _0x2e6d5f of this['getSuggestions']())if(_0x2e6d5f['author']['id']==_0x1e9a9c['id']&&_0x2e6d5f['isInContent']&&'deletion'==_0x2e6d5f['type']&&_0x2e6d5f['subType']==_0x50b54a&&(_0x1f878b(_0x2e6d5f['getRanges'](),_0x1fec1c)||_0x1f878b(_0x1fec1c,_0x2e6d5f['getRanges']()))){if(_0x1ce7db){if(_0x2e6d5f['commentThread']&&_0x2e6d5f['commentThread']['length'])continue;for(const _0x5dbd8e of _0x2e6d5f['getRanges']())_0x1ce7db['isIntersectingWithRange'](_0x5dbd8e)||_0x1ce7db['addRange'](_0x5dbd8e);_0x2e6d5f['removeMarkers']();}else{_0x1ce7db=_0x2e6d5f;for(const _0x4bfdf6 of _0x1fec1c)_0x2e6d5f['isIntersectingWithRange'](_0x4bfdf6)||_0x2e6d5f['addRange'](_0x4bfdf6);}}if(_0x1ce7db)return _0x1ce7db;_0x3e17bf['clear']();for(const _0x1fb32e of _0x1fec1c)for(const {suggestion:_0x43e980,meta:_0x564e14}of this['_findSuggestions'](_0x1fb32e,'deletion'))_0x564e14['isOwn']&&_0x3e17bf['add'](_0x43e980);for(const _0x509dbc of _0x3e17bf){const _0x12b5c6=_0x509dbc['getRanges']();if(!_0x173c9d||!_0x173c9d['skipNestingCheck']){if(_0x1fec1c['every'](_0x4dabb0=>_0x12b5c6['some'](_0x24a394=>_0x24a394['containsRange'](_0x4dabb0,!0x0))))return _0x509dbc;}(!_0x509dbc['attributes']||!_0x509dbc['attributes']['skipNestingCheck'])&&(_0x12b5c6['every'](_0x58e6b1=>_0x1fec1c['some'](_0x10a87f=>_0x10a87f['containsRange'](_0x58e6b1,!0x0)))&&_0x509dbc['discard']());}const _0x2f7ddf=_0x17e38b(),_0x3c35d8=_0x1e9a9c['id'],_0x26aade='deletion:'+_0x50b54a,_0x46e89e=this['_setSuggestionData']({'id':_0x2f7ddf,'type':_0x26aade,'createdAt':new Date(),'authorId':_0x3c35d8,'attributes':_0x173c9d});for(const _0x43e9e4 of _0x1fec1c)_0x43e9e4['detach'](),_0x43e9e4['isCollapsed']||'$graveyard'==_0x43e9e4['root']['rootName']||this['_addSuggestionMarker'](_0x26aade,_0x2f7ddf,_0x3c35d8,_0x43e9e4,_0xf23b9['getMultiRangeId']());return _0x46e89e;}['_setSuggestionRange'](_0x71f8c7,_0x223ea){const _0x503cc8=_0x71f8c7['getFirstMarker']();this['_model']['change'](_0x39694b=>{_0x39694b['updateMarker'](_0x503cc8,{'range':_0x223ea});});}['_addThreadToSuggestion'](_0x4fa740){const _0x36cd90=_0x4fa740['id'],_0x6f68e2=this['editor']['config']['get']('collaboration.channelId');this['_commentsRepository']['hasCommentThread'](_0x36cd90)||this['_commentsRepository']['addCommentThread']({'channelId':_0x6f68e2,'threadId':_0x36cd90});const _0x2a1cde=this['_commentsRepository']['getCommentThread'](_0x36cd90);_0x2a1cde['unbind']('isRemovable'),_0x2a1cde['isRemovable']=!0x1,_0x4fa740['commentThread']=_0x2a1cde;}['_checkSuggestionCorrectness'](_0x5688fe,_0x101651,_0x2955d5,_0x1ba06b){if(_0x5688fe['type']!=_0x101651||_0x5688fe['subType']!=_0x2955d5||_0x5688fe['author']['id']!=_0x1ba06b)throw this['editor']['isReadOnly']=!0x0,new _0x6684a1('track-changes-suggestion-data-mismatch',this);}['_cutOutSuggestionMarker'](_0x13d14f,_0x9222e1){const _0x11eabe=_0x13d14f['getFirstRange']();if(_0x9222e1['isEqual'](_0x11eabe))_0x13d14f['removeMarkers']();else{if(_0x11eabe['containsRange'](_0x9222e1)){const _0x2caf21=this['_model']['createPositionAt'](_0x9222e1['start']['nodeBefore'],'end');this['_setSuggestionRange'](_0x13d14f,this['_model']['createRange'](_0x11eabe['start'],_0x2caf21));const _0x4442cf=_0x17e38b(),_0xd4b89=_0x13d14f['author']['id'],_0x32bb56=_0x13d14f['type']+':'+_0x13d14f['subType'];this['_setSuggestionData']({'id':_0x4442cf,'type':_0x32bb56,'createdAt':new Date(),'authorId':_0xd4b89,'data':_0x13d14f['data'],'attributes':_0x13d14f['attributes']});const _0x2db088=this['_model']['createPositionAt'](_0x9222e1['end']['parent'],'after'),_0x52fe5b=this['_model']['createRange'](_0x2db088,_0x11eabe['end']);this['_addSuggestionMarker'](_0x32bb56,_0x4442cf,_0xd4b89,_0x52fe5b);}else{if(_0x11eabe['containsPosition'](_0x9222e1['start'])){const _0x2d160b=this['_model']['createPositionAt'](_0x9222e1['start']['nodeBefore'],'end');this['_setSuggestionRange'](_0x13d14f,this['_model']['createRange'](_0x11eabe['start'],_0x2d160b));}else{const _0x51dccc=this['_model']['createPositionAt'](_0x9222e1['end']['parent'],'after');this['_setSuggestionRange'](_0x13d14f,this['_model']['createRange'](_0x51dccc,_0x11eabe['end']));}}}}['_rangeIsInLocalUserInsertion'](_0x586078){for(const {suggestion:_0x20b49a,meta:_0x4f00ad}of this['_findSuggestions'](_0x586078,'insertion')){if(!_0x4f00ad['isOwn'])continue;const _0x5691e5=_0x20b49a['getRanges']();for(const _0x8ef39d of _0x5691e5)if(!_0x586078['getDifference'](_0x8ef39d)['length'])return!0x0;}return!0x1;}['_getAuthorFromId'](_0x4dc5b5){const _0x1023da=this['editor']['plugins']['get']('Users')['getUser'](_0x4dc5b5);if(!_0x1023da)throw new _0x6684a1('track-changes-user-not-found',this);return _0x1023da;}['_createSuggestion'](_0x538b07,_0x135111,_0x413e17,_0x141c9e){const _0x46c3c8=this['_getAuthorFromId'](_0x141c9e),_0x275ec3=this['_suggestionFactory']['buildSuggestion'](_0x538b07,_0x135111,_0x413e17,_0x46c3c8,_0x42754e=>this['_updateSuggestionData'](_0x413e17,{'attributes':_0x42754e}));return this['listenTo'](_0x275ec3,'accept',()=>{this['_updateSuggestionData'](_0x413e17,{'state':'accepted'});},{'priority':'high'}),this['listenTo'](_0x275ec3,'discard',()=>{this['_updateSuggestionData'](_0x413e17,{'state':'rejected'});},{'priority':'high'}),this['_suggestions']['set'](_0x413e17,_0x275ec3),this['_suggestionState']['set'](_0x275ec3,'notReady'),_0x275ec3;}['_splitMarkerName'](_0x11d171){const _0x3a9085=_0x11d171['split'](':');return{'group':_0x3a9085[0x0],'type':_0x3a9085[0x1],'subType':_0x3a9085['length']>=0x5?_0x3a9085[0x2]:null,'id':_0x3a9085['length']<0x5?_0x3a9085[0x2]:_0x3a9085[0x3],'authorId':_0x3a9085['length']<0x5?_0x3a9085[0x3]:_0x3a9085[0x4],'markerCount':0x6==_0x3a9085['length']?_0x3a9085[0x5]:null};}['_breakSuggestionMarker'](_0x35a922,_0x340f83,_0x1a3903){const _0x125753=_0x35a922['getFirstRange'](),_0x3a5ba9=_0x125753['start'],_0x4c359e=_0x125753['end'];this['_setSuggestionRange'](_0x35a922,this['_model']['createRange'](_0x3a5ba9,_0x340f83));const _0x432d1e=_0x17e38b(),_0x3643d8=_0x35a922['author']['id'],_0x2609da=_0x35a922['type']+(_0x35a922['subType']?':'+_0x35a922['subType']:'');this['_setSuggestionData']({'id':_0x432d1e,'type':_0x2609da,'createdAt':new Date(),'authorId':_0x3643d8,'originalSuggestionId':_0x35a922['id'],'data':_0x35a922['data']}),'formatBlock'==_0x35a922['type']&&(_0x1a3903=this['_model']['createPositionBefore'](_0x1a3903['parent'])),this['_addSuggestionMarker'](_0x2609da,_0x432d1e,_0x3643d8,this['_model']['createRange'](_0x1a3903,_0x4c359e));}['_findSuggestions'](_0x2b94b1,_0x3d1d74=null){const _0x3713c5=[],_0x4fd53e=this['_model']['schema'],_0x57dfbb=this['editor']['plugins']['get']('Users')['me'];for(const _0xcf2331 of this['getSuggestions']())if(_0xcf2331['isInContent']&&(!_0x3d1d74||_0xcf2331['type']==_0x3d1d74))for(const _0x3c5bb2 of _0xcf2331['getRanges']()){const _0x4b0392=_0x2b94b1['start']['isEqual'](_0x3c5bb2['end'])||_0x2b94b1['end']['isEqual'](_0x3c5bb2['start']);if(_0x4b0392||_0x2b94b1['getIntersection'](_0x3c5bb2)){const _0x28bf3c=_0x2b94b1['containsRange'](_0x3c5bb2)&&wt(_0x4fd53e,_0x3c5bb2['start'],_0x2b94b1),_0x1cbff0=_0x3c5bb2['containsRange'](_0x2b94b1)&&wt(_0x4fd53e,_0x2b94b1['start'],_0x3c5bb2);_0x3713c5['push']({'suggestion':_0xcf2331,'meta':{'isOwn':_0x57dfbb==_0xcf2331['author'],'isNextTo':_0x4b0392,'isInsideObject':_0x28bf3c,'containsRangeInObject':_0x1cbff0}});break;}}return _0x3713c5;}['_addSuggestionMarker'](_0x4f1f9e,_0xa46949,_0x33399f,_0x59a4e1,_0x288e24=null){this['_model']['change'](_0x69b90=>{let _0x13d422='suggestion:'+_0x4f1f9e+':'+_0xa46949+':'+_0x33399f;_0x288e24&&(_0x13d422=_0x13d422+':'+_0x288e24),_0x69b90['addMarker'](_0x13d422,{'range':_0x59a4e1,'usingOperation':!0x0,'affectsData':!0x0});});}['_removeSuggestion'](_0x4d10f5){const _0x3c656f=_0x4d10f5['previous'],_0x39f93f=_0x4d10f5['next'];_0x4d10f5['previous']=null,null!=_0x3c656f&&(_0x3c656f['next']=null),_0x4d10f5['next']=null,null!=_0x39f93f&&(_0x39f93f['previous']=null),'ready'==this['_suggestionState']['get'](_0x4d10f5)&&(this['_suggestionState']['set'](_0x4d10f5,'removed'),this['fire']('suggestionUnloaded',_0x4d10f5,_0x3c656f,_0x39f93f));}['_setSuggestionData'](_0x96d786){const _0x34ce6e=_0x96d786['id'],_0x3512b6=this['addSuggestionData'](_0x96d786);if(this['_adapter']&&this['_adapter']['addSuggestion']){const _0x129120=this['editor']['plugins']['get']('PendingActions'),_0x53ec1c=_0x3512b6['hasComments'],_0x1b8d40=_0x3512b6['subType']?_0x3512b6['type']+':'+_0x3512b6['subType']:_0x3512b6['type'],t=this['editor']['locale']['t'],_0x55c38a=_0x129120['add'](t({'string':'Unsaved\x20change\x20in\x20suggestion.','id':'PENDING_ACTION_SUGGESTION'})),_0x405e78={'id':_0x34ce6e,'type':_0x1b8d40,'hasComments':_0x53ec1c,'data':_0x96d786['data']||null,'originalSuggestionId':_0x96d786['originalSuggestionId']||null,'attributes':_0x3512b6['attributes']};this['_adapter']['addSuggestion'](_0x405e78)['then'](_0x3f6209=>{_0x3512b6['_saved']=!0x0,_0x129120['remove'](_0x55c38a),_0x3f6209&&_0x3f6209['createdAt']&&(this['_suggestions']['get'](_0x34ce6e)['createdAt']=_0x3f6209['createdAt']);});}return _0x3512b6;}['_updateSuggestionData'](_0x16181b,_0x485dbd){const _0x28689a=this['editor']['plugins']['get']('PendingActions'),_0x4a2ec3=this['_suggestions']['get'](_0x16181b);if(this['_adapter']&&this['_adapter']['updateSuggestion']){if(_0x4a2ec3['_saved']){const t=this['editor']['locale']['t'],_0x1fbbd7=_0x28689a['add'](t({'string':'Unsaved\x20change\x20in\x20suggestion.','id':'PENDING_ACTION_SUGGESTION'}));this['_adapter']['updateSuggestion'](_0x16181b,_0x485dbd)['then'](()=>{_0x28689a['remove'](_0x1fbbd7);});}else _0x4a2ec3['on']('change:_saved',()=>{this['_updateSuggestionData'](_0x16181b,_0x485dbd);});}}['_getSuggestionData'](_0x4b911f){if(!this['_adapter']||!this['_adapter']['getSuggestion'])throw new _0x6684a1('track-changes-adapter-missing-getsuggestion',this);return this['_adapter']['getSuggestion'](_0x4b911f);}['_handleNewSuggestionMarker'](_0x424044){const {id:_0x6090b4,type:_0x45bb78,subType:_0x550832,authorId:_0x161e46}=this['_splitMarkerName'](_0x424044),_0x21c565=this['_suggestions']['get'](_0x6090b4)||this['_createSuggestion'](_0x45bb78,_0x550832,_0x6090b4,_0x161e46);switch(this['_checkSuggestionCorrectness'](_0x21c565,_0x45bb78,_0x550832,_0x161e46),this['_suggestionState']['get'](_0x21c565)){case'notReady':this['_getSuggestionData'](_0x6090b4)['then'](_0x24bf35=>{let _0x1952b4=Promise['resolve']();_0x24bf35['hasComments']&&(_0x1952b4=this['_commentsRepository']['fetchCommentThread']({'channelId':this['editor']['config']['get']('collaboration.channelId'),'threadId':_0x6090b4})),_0x1952b4['then'](()=>{this['addSuggestionData'](_0x24bf35)['_saved']=!0x0;});}),this['_suggestionState']['set'](_0x21c565,'markerReady');break;case'removed':this['_updateSuggestionData'](_0x6090b4,{'state':'open'});case'dataReady':this['_suggestionState']['set'](_0x21c565,'ready'),this['fire']('suggestionLoaded',_0x21c565);break;case'ready':this['fire']('suggestionChanged',_0x21c565);}_0x21c565['addMarkerName'](_0x424044),this['_refreshSuggestionsChain'](_0x21c565);}['_refreshSuggestionsChain'](_0x25a272){if(_0x25a272['isMultiRange'])return;let _0x1fe28e=!0x0,_0x54ea95=!0x0;for(const _0x139afb of this['getSuggestions']()){if(_0x139afb['isMultiRange'])continue;if(_0x139afb==_0x25a272||!_0x139afb['isInContent'])continue;if(_0x139afb['author']['id']!=_0x25a272['author']['id'])continue;const _0x52e87f=this['_suggestionFactory']['getSuggestionCallback'](_0x25a272['type'],_0x25a272['subType'],'chain'),_0x3bc02b=this['_suggestionFactory']['getSuggestionCallback'](_0x139afb['type'],_0x139afb['subType'],'chain'),_0x2eaf40=_0x52e87f(_0x25a272,_0x139afb),_0x234d23=_0x3bc02b(_0x25a272,_0x139afb);_0x2eaf40&&_0x234d23&&(_0x2eaf40[0x1]['commentThread']&&_0x2eaf40[0x1]['commentThread']['length']||(_0x2eaf40[0x0]['next']=_0x2eaf40[0x1],_0x2eaf40[0x1]['previous']=_0x2eaf40[0x0],_0x2eaf40[0x0]==_0x25a272?_0x54ea95=!0x1:_0x1fe28e=!0x1));}_0x25a272['previous']&&_0x1fe28e&&(_0x25a272['previous']['next']=null,_0x25a272['previous']=null),_0x25a272['next']&&_0x54ea95&&(_0x25a272['next']['previous']=null,_0x25a272['next']=null);}['_joinWithAdjacentSuggestions'](_0x3e1e59){for(const _0x262297 of this['_suggestions']['values']()){if(_0x262297==_0x3e1e59||!_0x262297['isInContent'])continue;if(_0x262297['type']!=_0x3e1e59['type']||_0x262297['author']['id']!=_0x3e1e59['author']['id']||_0x262297['subType']!=_0x3e1e59['subType'])continue;const _0x1487a1=this['_suggestionFactory']['getSuggestionCallback'](_0x3e1e59['type'],_0x3e1e59['subType'],'join');if(_0x1487a1(_0x262297['getRanges'](),_0x3e1e59['getRanges']())){if(_0x3e1e59['commentThread']&&_0x3e1e59['commentThread']['length'])continue;return this['_joinSuggestions'](_0x262297,_0x3e1e59),!0x0;}if(_0x1487a1(_0x3e1e59['getRanges'](),_0x262297['getRanges']())){if(_0x262297['commentThread']&&_0x262297['commentThread']['length'])continue;return this['_joinSuggestions'](_0x3e1e59,_0x262297),!0x0;}}return!0x1;}['_joinSuggestions'](_0x23864a,_0x55d54a){if(_0x23864a['isMultiRange'])for(const _0x17012f of _0x55d54a['getRanges']())_0x23864a['addRange'](_0x17012f);else{const _0x246f8c=_0x55d54a['getFirstRange']()['end'];this['_setSuggestionRange'](_0x23864a,this['_model']['createRange'](_0x23864a['getFirstRange']()['start'],_0x246f8c));}_0x55d54a['removeMarkers']();}}_0x3e6840(l,_0x37c232);class kt{constructor(_0x3504b2){this['_editor']=_0x3504b2,this['_model']=_0x3504b2['model'],this['_customCallbacks']=new Map(),this['_defaultCallbacks']=new Map(),this['_registerDefaultCallbacks']();}['buildSuggestion'](_0x2c1eaf,_0x586ebf,_0x2ef4f4,_0x29da36,_0x328f65){return new _0xf23b9(this['_model'],{'type':_0x2c1eaf,'subType':_0x586ebf,'id':_0x2ef4f4,'author':_0x29da36,'onAttributesChange':_0x328f65,'onAccept':(..._0x2e0eb6)=>this['getSuggestionCallback'](_0x2c1eaf,_0x586ebf,'accept')(..._0x2e0eb6),'onDiscard':(..._0xbc3a41)=>this['getSuggestionCallback'](_0x2c1eaf,_0x586ebf,'discard')(..._0xbc3a41)});}['registerCustomCallback'](_0x1f9d30,_0x48c22e,_0x4a37aa,_0x51861d){const _0x4262ff=_0x1f9d30+':'+_0x48c22e+':'+_0x4a37aa;this['_customCallbacks']['set'](_0x4262ff,_0x51861d);}['getSuggestionCallback'](_0x45b291,_0x2d26bc,_0x1e7129){const _0x1b7996=_0x45b291+':'+_0x2d26bc+':'+_0x1e7129;return this['_customCallbacks']['get'](_0x1b7996)||this['_defaultCallbacks']['get'](_0x45b291+':'+_0x1e7129);}['_registerDefaultCallbacks'](){const _0x328a70=()=>{},_0x1948ef=_0x23688=>{_0x23688['sort']((_0x5c5ffb,_0x41f69c)=>_0x5c5ffb['start']['isBefore'](_0x41f69c['start'])?0x1:-0x1),this['_model']['change'](_0x48487b=>{for(const _0x3047a6 of _0x23688){let _0x2cc38a;_0x2cc38a=_0x3047a6['end']['isAtEnd']&&_0x3047a6['end']['parent']==_0x3047a6['start']['nodeAfter']?_0x48487b['createSelection'](_0x3047a6['start']['nodeAfter'],'on'):_0x48487b['createSelection'](_0x3047a6),this['_model']['deleteContent'](_0x2cc38a,{'forceDefaultExecution':!0x0,'doNotAutoparagraph':!0x0});}});},_0xf95ee6=(_0x17277e,_0x5bd8da)=>{this['_model']['change'](_0x37017f=>{const {commandName:_0x466d15,commandParams:_0x284632=[]}=_0x5bd8da,_0x173709=_0x17277e[0x0];if('$graveyard'==_0x173709['root']['rootName'])return;const _0x483514=Array['from'](this['_model']['document']['selection']['getRanges']())['map'](_0x5a08b7=>_0x2dbd60['fromRange'](_0x5a08b7));yt(_0x173709)?_0x37017f['setSelection'](this['_model']['createRange'](_0x173709['end'])):_0x37017f['setSelection'](_0x173709);for(const _0x2fdbe3 of this['_editor']['commands']['commands']())_0x2fdbe3['refresh']();_0x284632['push']({'forceDefaultExecution':!0x0}),this['_editor']['execute'](_0x466d15,..._0x284632);const _0x1f5e28=_0x483514['filter'](_0x30c1ec=>'$graveyard'!=_0x30c1ec['root']['rootName']);_0x1f5e28['length']>0x0&&_0x37017f['setSelection'](_0x1f5e28);for(const _0x52d29b of _0x483514)_0x52d29b['detach']();});},_0x3b0e7e=(_0x30f0b9,_0x2277f9)=>0x1==_0x30f0b9['length']&&0x1==_0x2277f9['length']&&_0x30f0b9[0x0]['end']['isEqual'](_0x2277f9[0x0]['start']),_0x42724c=(_0x4b1e48,_0x5cace1)=>Dt(_0x4b1e48,_0x5cace1,this['_model'])?[_0x4b1e48,_0x5cace1]:Dt(_0x5cace1,_0x4b1e48,this['_model'])?[_0x5cace1,_0x4b1e48]:null;this['_defaultCallbacks']['set']('insertion:accept',_0x328a70),this['_defaultCallbacks']['set']('insertion:discard',_0x1948ef),this['_defaultCallbacks']['set']('insertion:join',_0x3b0e7e),this['_defaultCallbacks']['set']('insertion:chain',_0x42724c),this['_defaultCallbacks']['set']('deletion:accept',_0x1948ef),this['_defaultCallbacks']['set']('deletion:discard',_0x328a70),this['_defaultCallbacks']['set']('deletion:join',_0x3b0e7e),this['_defaultCallbacks']['set']('deletion:chain',_0x42724c),this['_defaultCallbacks']['set']('formatInline:accept',_0xf95ee6),this['_defaultCallbacks']['set']('formatInline:discard',_0x328a70),this['_defaultCallbacks']['set']('formatInline:join',_0x3b0e7e),this['_defaultCallbacks']['set']('formatInline:chain',_0x328a70),this['_defaultCallbacks']['set']('formatBlock:accept',_0xf95ee6),this['_defaultCallbacks']['set']('formatBlock:discard',_0x328a70),this['_defaultCallbacks']['set']('formatBlock:join',_0x3b0e7e),this['_defaultCallbacks']['set']('formatBlock:chain',_0x328a70);}}function wt(_0x4caf58,_0x119ed0,_0x11eea5){for(const _0x3ccffa of _0x119ed0['parent']['getAncestors']({'includeSelf':!0x0,'parentFirst':!0x0})){if(_0x3ccffa['root']==_0x3ccffa)return!0x1;if(!_0x11eea5['containsItem'](_0x3ccffa))return!0x1;if(_0x4caf58['isObject'](_0x3ccffa)||_0x4caf58['isLimit'](_0x3ccffa))return!0x0;}}function yt(_0x746e09){return _0x746e09['end']['parent']==_0x746e09['start']['nodeAfter']&&_0x746e09['end']['isAtStart'];}function St(_0xc12e94,_0xdaedba,_0x17c7b3,_0x308c28){const _0x1de82f=_0x193961=>!_0x193961['item']['is']('textProxy')&&!_0x308c28['isObject'](_0x193961['item']),_0x4de93f=_0xc12e94['start']['getLastMatchingPosition'](_0x1de82f),_0x249edb=_0xc12e94['end']['getLastMatchingPosition'](_0x1de82f,{'direction':'backward'});return(!_0xc12e94['start']['isEqual'](_0x4de93f)||!_0xc12e94['end']['isEqual'](_0x249edb))&&(_0x4de93f['isBefore'](_0x249edb)?_0x17c7b3['updateMarker'](_0xdaedba,{'range':_0x17c7b3['createRange'](_0x4de93f,_0x249edb)}):_0x17c7b3['removeMarker'](_0xdaedba),!0x0);}function bt(_0x42234a){return mt(_0x42234a);}function It(_0x2539e5){const _0x3eea91=_0x2539e5['start']['nodeAfter'];return _0x3eea91&&_0x3eea91['is']('element');}function vt(_0x304e67,_0x6f7cf1){const _0x23c093=_0x6f7cf1['schema']['isObject'](_0x304e67)||_0x6f7cf1['schema']['isSelectable'](_0x304e67);return _0x6f7cf1['createRange'](_0x6f7cf1['createPositionAt'](_0x304e67,'before'),_0x23c093?_0x6f7cf1['createPositionAfter'](_0x304e67):_0x6f7cf1['createPositionAt'](_0x304e67,'end'));}function Dt(_0x1f0d78,_0x446244,_0x573da5){const _0x5f13ae=_0x1f0d78['getFirstRange'](),_0x1c8d9e=_0x446244['getFirstRange']();if(_0x5f13ae['end']['isEqual'](_0x1c8d9e['start']))return!0x0;if(_0x1f0d78['type']!=_0x446244['type'])return!0x1;if(!_0x5f13ae['end']['isTouching'](_0x1c8d9e['start']))return!0x1;const _0x451686=_0x573da5['createRange'](_0x5f13ae['end'],_0x1c8d9e['start'])['getWalker']();for(const _0x1bb75e of _0x451686)if(['elementStart','elementEnd']['includes'](_0x1bb75e['type'])&&_0x573da5['schema']['isLimit'](_0x1bb75e['item']))return!0x1;return!0x0;}