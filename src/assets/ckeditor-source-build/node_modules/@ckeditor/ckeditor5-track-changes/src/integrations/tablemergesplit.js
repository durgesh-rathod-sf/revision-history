/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x234039}from'ckeditor5/src/core';import _0x2187be from'@ckeditor/ckeditor5-table/src/tablewalker';import ht from'./table';import{getSelectionAffectedTableCells as _0x2ed7de}from'@ckeditor/ckeditor5-table/src/utils/selection';import{LiveRange as _0x494018}from'ckeditor5/src/engine';export default class ut extends _0x234039{static get['requires'](){return[ht];}['afterInit'](){const _0x3d6c59=this['editor'],_0x405fe4=_0x3d6c59['model']['document']['selection'];if(!_0x3d6c59['plugins']['has']('TableEditing'))return;const {t:t}=_0x3d6c59['locale'],_0x38d9f1=_0x3d6c59['plugins']['get']('TrackChangesEditing'),_0x19daa2=_0x3d6c59['plugins']['get']('TableUtils'),_0x20f3d5=_0x3d6c59['plugins']['get'](ht);_0x20f3d5['_tablePostFixingSubtypes']['push']('mergeTableCells'),_0x38d9f1['enableCommand']('mergeTableCells',()=>{const _0xef867b=_0x2ed7de(_0x3d6c59['model']['document']['selection']);_0x3d6c59['model']['change'](()=>{_0x38d9f1['markMultiRangeBlockFormat'](_0xef867b,{'commandName':'mergeTableCells','commandParams':[]},[],'mergeTableCells');});}),_0x3d6c59['commands']['get']('mergeTableCells')['on']('execute',(_0x489c43,_0x4ff1dc)=>{_0x3d6c59['commands']['get']('trackChanges')['value']&&(_0x4ff1dc['length']>0x0&&_0x4ff1dc[_0x4ff1dc['length']-0x1]&&_0x4ff1dc[_0x4ff1dc['length']-0x1]['forceDefaultExecution']||_0x38d9f1['_isForcedDefaultExecutionBlock']||this['_areSelectedCellsMergable']()||_0x489c43['stop']());},{'priority':'highest'});for(const _0x189045 of['mergeTableCellUp','mergeTableCellRight','mergeTableCellDown','mergeTableCellLeft']){const _0x50f1aa=_0x3d6c59['commands']['get'](_0x189045);_0x38d9f1['enableCommand'](_0x189045,()=>{const _0xf69d94=_0x3d6c59['model']['document']['selection']['getFirstPosition']()['getAncestors']()['find'](_0x246922=>_0x246922['is']('element','tableCell')),_0x45e5bc=_0x50f1aa['value'];_0x3d6c59['model']['change'](()=>{_0x38d9f1['markMultiRangeBlockFormat']([_0xf69d94,_0x45e5bc],{'commandName':'mergeTableCells','commandParams':[]},[],'mergeTableCells');});});}for(const _0x57d8fd of['splitTableCellVertically','splitTableCellHorizontally']){const _0x2680c3=_0x3d6c59['commands']['get'](_0x57d8fd);_0x38d9f1['enableCommand'](_0x57d8fd,()=>{const _0xf0ecd=_0x2ed7de(_0x3d6c59['model']['document']['selection'])[0x0],_0x38d845=_0xf0ecd['findAncestor']('table'),{column:_0x3ffaa1,row:_0x5015b5}=_0x19daa2['getCellLocation'](_0xf0ecd);let _0x506e71=[];if('horizontally'==_0x2680c3['direction']){const _0x46416b=new _0x2187be(_0x38d845,{'startRow':_0x5015b5,'endRow':_0x5015b5,'includeAllSlots':!0x0});_0x506e71=Array['from'](_0x46416b)['map'](_0x50a594=>_0x50a594['cell']);}else{const _0x59cf41=new _0x2187be(_0x38d845,{'column':_0x3ffaa1,'includeAllSlots':!0x0});_0x506e71=Array['from'](_0x59cf41)['map'](_0x46a439=>_0x46a439['cell']);}_0x3d6c59['model']['change'](_0x41fa92=>{_0x38d9f1['markBlockFormat'](_0x41fa92['createRangeOn'](_0xf0ecd),{'commandName':_0x57d8fd,'commandParams':[]},_0x506e71,_0x57d8fd);});});}_0x38d9f1['_descriptionFactory']['registerDescriptionCallback'](_0xf2e6fd=>{const {data:_0x18c569}=_0xf2e6fd;if(_0x18c569)return'mergeTableCells'==_0x18c569['commandName']?{'type':'format','content':t('*Merge\x20cells*')}:void 0x0;}),_0x38d9f1['_descriptionFactory']['registerDescriptionCallback'](_0x40c870=>{const {data:_0x4e19c7}=_0x40c870;if(_0x4e19c7)return'splitTableCellVertically'==_0x4e19c7['commandName']?{'type':'format','content':t('*Split\x20cell:*\x20vertically')}:'splitTableCellHorizontally'==_0x4e19c7['commandName']?{'type':'format','content':t('*Split\x20cell:*\x20horizontally')}:void 0x0;});const _0x569e79=_0x20f3d5['_acceptFormatSuggestionCallbackFactory']();for(const _0x2a2d13 of['mergeTableCellUp','mergeTableCellRight','mergeTableCellDown','mergeTableCellLeft'])_0x38d9f1['_suggestionFactory']['registerCustomCallback']('formatBlock',_0x2a2d13,'accept',_0x569e79);for(const _0xd942a8 of['splitTableCellVertically','splitTableCellHorizontally'])_0x38d9f1['_suggestionFactory']['registerCustomCallback']('formatBlock',_0xd942a8,'accept',_0x569e79);_0x38d9f1['_suggestionFactory']['registerCustomCallback']('formatBlock','mergeTableCells','accept',_0x15b7f0=>{_0x3d6c59['model']['change'](_0x5c804d=>{const _0x56d9e9=Array['from'](_0x405fe4['getRanges']())['map'](_0x45b4d1=>_0x494018['fromRange'](_0x45b4d1));_0x5c804d['setSelection'](_0x15b7f0),_0x3d6c59['commands']['get']('mergeTableCells')['refresh'](),_0x3d6c59['execute']('mergeTableCells',{'forceDefaultExecution':!0x0});const _0x5438ee=_0x56d9e9['filter'](_0x217bd0=>'$graveyard'!=_0x217bd0['root']['rootName']);_0x5438ee['length']>0x0&&_0x5c804d['setSelection'](_0x5438ee);for(const _0x42634c of _0x56d9e9)_0x42634c['detach']();});});for(const _0x390a7f of['mergeTableCellUp','mergeTableCellDown','mergeTableCellLeft','mergeTableCellRight']){const _0x557726=_0x3d6c59['commands']['get'](_0x390a7f);_0x557726['on']('set:isEnabled',(_0x2f2e83,_0x178f16,_0x2ddcb2)=>{if(_0x2ddcb2){const _0x46c733=_0x3d6c59['model']['document']['selection']['getFirstPosition']()['getAncestors']()['find'](_0x2db6e2=>_0x2db6e2['is']('element','tableCell'));this['_areMergableCells'](_0x557726['value'],_0x46c733)||(_0x2f2e83['return']=!0x1,_0x2f2e83['stop']());}},{'priority':'low'});}}['_areSelectedCellsMergable'](){if(!this['editor']['commands']['get']('mergeTableCells')['isEnabled'])return!0x1;const _0x591857=_0x2ed7de(this['editor']['model']['document']['selection']);for(const _0x4773f1 of _0x591857)for(const _0x195d03 of _0x591857)if(_0x4773f1!=_0x195d03&&!this['_areMergableCells'](_0x4773f1,_0x195d03))return!0x1;return!0x0;}['_areMergableCells'](_0x1b4d39,_0x395612){const _0x19af38=this['editor']['plugins']['get']('TrackChangesEditing'),_0x52d1fc=this['editor']['model']['createRangeOn'](_0x1b4d39),_0x5036bb=this['editor']['model']['createRangeOn'](_0x395612),_0x20be54=new Set(),_0x596539=new Set();for(const _0x2152b6 of _0x19af38['getSuggestions']())if(('insertion'==_0x2152b6['type']||'deletion'==_0x2152b6['type']||'mergeTableCells'==_0x2152b6['subType'])&&_0x2152b6['isInContent'])for(const _0x18ba2e of _0x2152b6['getRanges']())_0x18ba2e['containsRange'](_0x52d1fc,!0x0)&&_0x20be54['add'](_0x2152b6['type']+':'+_0x2152b6['author']['id']),_0x18ba2e['containsRange'](_0x5036bb,!0x0)&&_0x596539['add'](_0x2152b6['type']+':'+_0x2152b6['author']['id']);if(_0x20be54['size']!=_0x596539['size'])return!0x1;for(const _0x22f354 of _0x20be54)if(!_0x596539['has'](_0x22f354))return!0x1;return!0x0;}}