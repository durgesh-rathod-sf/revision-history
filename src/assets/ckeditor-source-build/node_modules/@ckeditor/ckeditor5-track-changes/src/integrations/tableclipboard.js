/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x489861}from'ckeditor5/src/core';import _0x3b8c6a from'@ckeditor/ckeditor5-table/src/tablewalker';import ht from'./table';import{uid as _0x1632d3,priorities as _0x3cbb11}from'ckeditor5/src/utils';import{getTableIfOnlyTableInContent as _0x44ceb2}from'@ckeditor/ckeditor5-table/src/tableclipboard';import{getColumnIndexes as _0x53c13c,getRowIndexes as _0x1f87b5,getSelectionAffectedTableCells as _0x339d04}from'@ckeditor/ckeditor5-table/src/utils/selection';const be=['tableCellBorderWidth','tableCellBorderColor','tableCellBorderStyle','tableCellHorizontalAlignment','tableCellVerticalAlignment','tableCellBackgroundColor','tableCellPadding'],de=Object['fromEntries'](be['map'](_0x26d6db=>[_0x26d6db,null]));export default class gt extends _0x489861{static get['requires'](){return[ht];}['afterInit'](){const _0xed8e87=this['editor'];if(!_0xed8e87['plugins']['has']('TableClipboard'))return;const {t:t}=_0xed8e87['locale'],_0x591d37=_0xed8e87['plugins']['get']('TrackChangesEditing'),_0x2525e5=_0xed8e87['plugins']['get']('TableUtils'),_0x3cdc40=_0xed8e87['plugins']['get'](ht);_0x3cdc40['_tablePostFixingSubtypes']['push']('tablePasteRow','tablePasteColumn'),_0xed8e87['model']['schema']['register']('tableCellSuggestion',{'allowIn':'tableCell','allowContentOf':'tableCell','isLimit':!0x0}),_0xed8e87['conversion']['elementToElement']({'model':'tableCellSuggestion','view':'suggestion-td'});let _0x11798a=null;_0xed8e87['model']['on']('insertContent',(_0x18dbd7,_0x1f7d3f)=>{const [_0xe427aa,_0x42e8bb]=_0x1f7d3f,_0x418568=_0x1f7d3f[_0x1f7d3f['length']-0x1];_0x418568&&_0x418568['forceDefaultExecution']||_0x591d37['_isForcedDefaultExecutionBlock']||this['editor']['commands']['get']('trackChanges')['value']&&function(_0x4b5269,_0xe82608,_0x4fdf83,_0x6fd4b8){if(_0xe82608&&!_0xe82608['is']('documentSelection'))return!0x1;const _0x173ea7=_0x44ceb2(_0x4b5269,_0x4fdf83);if(!_0x173ea7||!me(_0x173ea7))return!0x1;const _0x45bfa5=_0x339d04(_0x4fdf83['document']['selection']);if(!_0x45bfa5['length'])return!0x1;const _0x592558=_0x45bfa5[0x0]['findAncestor']('table'),_0x4eddbf=_0x1f87b5(_0x45bfa5),_0xa2b39e=_0x53c13c(_0x45bfa5),_0xcbb8eb={'startRow':_0x4eddbf['first'],'endRow':_0x4eddbf['last'],'startColumn':_0xa2b39e['first'],'endColumn':_0xa2b39e['last']};return 0x1==_0x45bfa5['length']&&(_0xcbb8eb['endRow']+=_0x6fd4b8['getRows'](_0x173ea7)-0x1,_0xcbb8eb['endColumn']+=_0x6fd4b8['getColumns'](_0x173ea7)-0x1),me(_0x592558,_0xcbb8eb);}(_0xe427aa,_0x42e8bb,_0xed8e87['model'],_0x2525e5)&&(_0x18dbd7['stop'](),_0x11798a={'cells':[],'insertionRanges':[],'deletionRanges':[],'rowInsertionRanges':[],'rowInsertionIndexes':[],'columnInsertionRanges':[],'columnInsertionIndexes':[]},_0xed8e87['model']['change'](()=>{_0xed8e87['model']['insertContent'](_0x1f7d3f[0x0],_0x1f7d3f[0x1],_0x1f7d3f[0x2],_0x1f7d3f[0x3],{'forceDefaultExecution':!0x0});const _0x4aed5d=_0x1632d3(),{rowInsertionRanges:_0x3f6b8e,columnInsertionRanges:_0x2d71be,insertionRanges:_0x1c7ce9,deletionRanges:_0x4d4252,cells:_0x597b40}=_0x11798a;_0x3f6b8e['length']&&_0x591d37['markMultiRangeInsertion'](_0x3f6b8e,'tablePasteRow',{'tablePasteChainId':_0x4aed5d}),_0x2d71be['length']&&_0x591d37['markMultiRangeInsertion'](_0x2d71be,'tablePasteColumn',{'tablePasteChainId':_0x4aed5d}),_0x1c7ce9['length']&&_0x591d37['markMultiRangeInsertion'](_0x1c7ce9,'tablePaste',{'tablePasteChainId':_0x4aed5d,'skipNestingCheck':!0x0}),_0x4d4252['length']&&_0x591d37['markMultiRangeDeletion'](_0x4d4252,'tablePaste',{'tablePasteChainId':_0x4aed5d,'skipNestingCheck':!0x0});const _0xa19eb5=_0x591d37['markMultiRangeBlockFormat'](_0x597b40['map'](({element:_0x4725d6})=>_0x4725d6),{'formatGroupId':_0x1632d3()},[],'tablePasteCell',{'tablePasteChainId':_0x4aed5d});if(_0xa19eb5){const _0x51fdcb=_0xa19eb5['getMarkers'](),_0x1d577e=[];for(const {element:_0x481009,attributes:_0x1b643a}of _0x597b40){if(!_0x1b643a)continue;const _0x38752a=_0xed8e87['model']['createRangeOn'](_0x481009),_0x505260=_0x51fdcb['find'](_0x10ea01=>_0x10ea01['getRange']()['isEqual'](_0x38752a));_0x505260&&_0x1d577e['push']([_0x505260['name'],_0x1b643a]);}_0x1d577e['length']&&_0xa19eb5['setAttribute']('markerAttributes',Object['fromEntries'](_0x1d577e));}_0x11798a=null;}));},{'priority':_0x3cbb11['high']+0xa}),_0xed8e87['plugins']['get']('TableClipboard')['on']('_replaceTableSlotCell',(_0x111088,_0xc34ac)=>{const [_0x2b53a4,_0x477e3c,,_0x5c5718]=_0xc34ac;if(!_0x11798a)return;_0x111088['stop']();const _0x444579=_0x2b53a4['cell'],_0x174b89=_0x477e3c,_0x4df303=ge(_0x444579),_0x2e0b65=ge(_0x174b89);_0x111088['return']=_0x444579;let _0x32682a=null,_0x3f09ca=null;if(_0x2e0b65||_0x4df303){if(_0x4df303&&!_0x2e0b65){_0x5c5718['remove'](_0x444579['getChild'](0x0));for(const _0x17aec0 of Array['from'](_0x174b89['getChildren']()))_0x5c5718['insert'](_0x17aec0,_0x444579,'end');const _0x4f61d6=_0x11798a['rowInsertionIndexes']['includes'](_0x2b53a4['row']),_0x21e10a=_0x11798a['columnInsertionIndexes']['includes'](_0x2b53a4['column']);_0x4f61d6||_0x21e10a||(_0x32682a=_0x5c5718['createRangeIn'](_0x444579));}else _0x2e0b65&&!_0x4df303&&(_0x3f09ca=_0x5c5718['createRangeIn'](_0x444579));}else{const _0x2f4fec=_0x5c5718['createElement']('tableCellSuggestion'),_0x57bcb5=_0x5c5718['createElement']('tableCellSuggestion');_0x5c5718['wrap'](_0x5c5718['createRangeIn'](_0x444579),_0x57bcb5),_0x5c5718['insert'](_0x2f4fec,_0x444579,0x0);for(const _0x53bb05 of Array['from'](_0x174b89['getChildren']()))_0x5c5718['insert'](_0x53bb05,_0x2f4fec,'end');_0x32682a=_0x5c5718['createRangeOn'](_0x2f4fec),_0x3f09ca=_0x5c5718['createRangeOn'](_0x57bcb5);}const _0x5b39cf=Array['from'](_0x174b89['getAttributes']())['filter'](([_0x223841])=>be['includes'](_0x223841));_0x11798a['cells']['push']({'element':_0x444579,'attributes':_0x5b39cf['length']?Object['fromEntries'](_0x5b39cf):null}),_0x32682a&&_0x11798a['insertionRanges']['push'](_0x32682a),_0x3f09ca&&_0x11798a['deletionRanges']['push'](_0x3f09ca);},{'priority':'high'}),_0x2525e5['on']('insertColumns',(_0x3344b6,_0x330711)=>{const [_0x4968b5,_0x13a802={}]=_0x330711;if(!_0x11798a)return;const _0x466290=_0x13a802['at']||0x0,_0x4e417b=_0x13a802['columns']||0x1;_0x11798a['columnInsertionIndexes']=new Array(_0x4e417b)['fill'](_0x466290)['map']((_0x233de8,_0x203917)=>_0x233de8+_0x203917);for(const {cell:_0x122bbd}of new _0x3b8c6a(_0x4968b5,{'startColumn':_0x466290,'endColumn':_0x466290+_0x4e417b-0x1}))_0x11798a['columnInsertionRanges']['push'](_0xed8e87['model']['createRangeOn'](_0x122bbd));},{'priority':'low'}),_0x2525e5['on']('insertRows',(_0x272872,_0x17f41b)=>{const [_0x893428,_0x3cd155={}]=_0x17f41b;if(!_0x11798a)return;const _0x4aa84e=_0x3cd155['at']||0x0,_0x1c87af=_0x3cd155['rows']||0x1;_0x11798a['rowInsertionIndexes']=new Array(_0x1c87af)['fill'](_0x4aa84e)['map']((_0x37f083,_0x3af75a)=>_0x37f083+_0x3af75a);for(const {cell:_0x1efa46}of new _0x3b8c6a(_0x893428,{'startRow':_0x4aa84e,'endRow':_0x4aa84e+_0x1c87af-0x1}))_0x11798a['rowInsertionRanges']['push'](_0xed8e87['model']['createRangeOn'](_0x1efa46));},{'priority':'low'}),_0x591d37['_descriptionFactory']['registerDescriptionCallback'](_0x2b899e=>{if(_0x2b899e['subType']&&_0x2b899e['subType']['startsWith']('tablePaste'))return _0x2b899e['previous']?{}:{'type':'insertion','content':t('*Replace\x20table\x20cells*')};});const _0x5cee2f=()=>{};for(const _0xe82847 of['tablePaste','tablePasteColumn','tablePasteRow','tablePasteCell'])_0x591d37['_suggestionFactory']['registerCustomCallback']('insertion',_0xe82847,'join',_0x5cee2f),_0x591d37['_suggestionFactory']['registerCustomCallback']('deletion',_0xe82847,'join',_0x5cee2f);_0x591d37['_suggestionFactory']['registerCustomCallback']('formatBlock','tablePasteCell','discard',_0x5cee2f),_0x591d37['_suggestionFactory']['registerCustomCallback']('formatBlock','tablePasteCell','accept',(_0x2afcee,_0x2cc6ac,_0x5131ce)=>{const _0x4813f6=_0x2afcee['map'](_0xc53010=>_0xc53010['getContainedElement']())['filter'](_0x10064d=>_0x10064d),_0x35c9e4=new Map(_0x4813f6['map'](_0x25a2f7=>[_0x25a2f7,null]));if(_0x11798a)for(const {element:_0xd74827,attributes:_0x50be4d}of _0x11798a['cells'])_0x50be4d&&_0x35c9e4['set'](_0xd74827,_0x50be4d);else{if(_0x5131ce&&_0x5131ce['markerAttributes'])for(const [_0x2d5285,_0x35babd]of Object['entries'](_0x5131ce['markerAttributes'])){const _0x271c6b=_0xed8e87['model']['markers']['get'](_0x2d5285),_0x1d273b=_0x271c6b?_0x271c6b['getRange']()['getContainedElement']():null;_0x1d273b&&_0x35c9e4['set'](_0x1d273b,_0x35babd);}}_0xed8e87['model']['change'](_0x1988ac=>{for(const [_0xc69273,_0x283929]of _0x35c9e4)_0x1988ac['setAttributes']({...de,..._0x283929},_0xc69273);});});const _0x4a14b9=(_0x3d1940,_0x3e83c5)=>{_0x591d37['_suggestionFactory']['registerCustomCallback'](_0x3d1940,'tablePaste',_0x3e83c5,(_0x3ab65c,_0xc7facf,_0x412bc4)=>{_0xed8e87['model']['change'](_0x12ac50=>{const _0x49683a=[];for(const _0x1229f8 of _0x3ab65c){const _0x303963=_0x1229f8['start']['nodeAfter'];_0x303963['is']('element','tableCellSuggestion')&&_0x49683a['push'](_0x303963);}_0x591d37['_suggestionFactory']['getSuggestionCallback'](_0x3d1940,null,_0x3e83c5)(_0x3ab65c,_0xc7facf,_0x412bc4);for(const _0x194efa of _0x49683a)'$graveyard'!=_0x194efa['root']['rootName']&&_0x12ac50['unwrap'](_0x194efa);});});};_0x4a14b9('insertion','accept'),_0x4a14b9('insertion','discard'),_0x4a14b9('deletion','accept'),_0x4a14b9('deletion','discard'),_0x591d37['_suggestionFactory']['registerCustomCallback']('insertion','tablePasteRow','discard',_0x1b5844=>{const _0x6d2580=_0x1b5844['map'](_0x62568c=>_0x62568c['getContainedElement']()),_0x5f0c21=_0x6d2580[0x0]['findAncestor']('table'),{minRow:_0x5ef59e,maxRow:_0x33b72f}=_0x3cdc40['_getCoordsForCells'](_0x6d2580);_0x2525e5['removeRows'](_0x5f0c21,{'at':_0x5ef59e,'rows':_0x33b72f-_0x5ef59e+0x1});}),_0x591d37['_suggestionFactory']['registerCustomCallback']('insertion','tablePasteColumn','discard',_0x39bde0=>{const _0x378884=_0x39bde0['map'](_0x344f7f=>_0x344f7f['getContainedElement']()),_0x495d80=_0x378884[0x0]['findAncestor']('table'),{minColumn:_0xca3be4,maxColumn:_0x2ee3bb}=_0x3cdc40['_getCoordsForCells'](_0x378884);_0x2525e5['removeColumns'](_0x495d80,{'at':_0xca3be4,'columns':_0x2ee3bb-_0xca3be4+0x1});});const _0x1bcbb7=(_0x10a9d7,_0x7e8747)=>{if(!_0x7e8747['subType']||!_0x7e8747['subType']['startsWith']('tablePaste'))return;const _0x4f5303=_0x7e8747['attributes']['tablePasteChainId'],_0x3852a9=_0x591d37['getSuggestions']()['filter'](_0x4e460b=>_0x4e460b['isInContent']&&_0x4e460b['attributes']&&_0x4e460b['attributes']['tablePasteChainId']==_0x4f5303);_0x3852a9['length']&&_0x7e8747['getAllAdjacentSuggestions']()['length']!=_0x3852a9['length']&&_0x3852a9['reduce']((_0x4f8145,_0x213448)=>(_0x4f8145['next']=_0x213448,_0x213448['previous']=_0x4f8145,_0x213448));};function _0x16cf53(_0x73280,{showActiveMarker:_0x596836=!0x0}={}){const {id:_0x154989}=_0x591d37['_splitMarkerName'](_0x73280['markerName']),_0x2264dc=['ck-suggestion-marker','ck-suggestion-marker-insertion'],_0x49bb8c=_0x591d37['activeMarkers']['includes'](_0x73280['markerName']);return _0x49bb8c&&_0x2264dc['push']('ck-suggestion-marker--active'),{'classes':_0x2264dc,'attributes':{'data-suggestion':_0x154989},'priority':_0x49bb8c&&_0x596836?0xbc2:0xbb8};}_0x591d37['on']('suggestionLoaded',_0x1bcbb7,{'priority':'high'}),_0x591d37['on']('suggestionUnloaded',_0x1bcbb7,{'priority':'high'}),_0xed8e87['model']['document']['registerPostFixer'](()=>{let _0x4f2280=!0x1;const _0x31497f=Array['from'](_0xed8e87['model']['document']['differ']['getChangedMarkers']());for(const {name:_0x4875d2,data:_0x198bff}of _0x31497f){const {group:_0x5af347,type:_0x374646,id:_0x3b1723}=_0x591d37['_splitMarkerName'](_0x4875d2);if('suggestion'!=_0x5af347||'deletion'!=_0x374646||_0x198bff['oldRange'])continue;if(!_0x591d37['hasSuggestion'](_0x3b1723))continue;const _0x5df84f=_0x591d37['getSuggestion'](_0x3b1723)['getRanges'](),_0x3ed323=_0xed8e87['plugins']['get']('Users')['me'];for(const _0x12157 of _0x591d37['getSuggestions']()){if(!_0x12157['isInContent']||_0x12157['author']!=_0x3ed323)continue;if('formatBlock'!=_0x12157['type']||'tablePasteCell'!=_0x12157['subType'])continue;if(_0x12157['getRanges']()['every'](_0x1e94f0=>_0x5df84f['some'](_0x4198c0=>_0x4198c0['containsRange'](_0x1e94f0,!0x0))))for(const _0x53121e of _0x12157['getAllAdjacentSuggestions']())_0x53121e['isInContent']&&(_0x53121e['discard'](),_0x4f2280=!0x0);}}return _0x4f2280;}),_0xed8e87['model']['document']['registerPostFixer'](_0x39886f=>{const _0x4594da=_0xed8e87['commands']['get']('redo');if(!_0x4594da||!_0x4594da['_createdBatches']['has'](_0x39886f['batch']))return!0x1;let _0x3d0753=!0x1;const _0x382327=_0xed8e87['plugins']['get']('Users')['me'],_0x5dc80e=_0xed8e87['model']['document']['differ']['getChanges'](),_0x5e8707=Array['from'](_0xed8e87['model']['document']['differ']['getChangedMarkers']())['filter'](({name:_0x2614c2,data:_0x455be9})=>{const {group:_0x10049c,subType:_0x1470dd,authorId:_0x4712bb}=_0x591d37['_splitMarkerName'](_0x2614c2);return'suggestion'==_0x10049c&&'tablePaste'==_0x1470dd&&_0x4712bb==_0x382327['id']&&!_0x455be9['oldRange'];});for(const _0x2b155d of _0x5dc80e){if('insert'!=_0x2b155d['type']||'tableCellSuggestion'!=_0x2b155d['name']||0x1!=_0x2b155d['length'])continue;const _0x181953=_0x39886f['createRange'](_0x2b155d['position'],_0x2b155d['position']['getShiftedBy'](0x1));if(!_0x5e8707['find'](({data:_0x4e924e})=>_0x4e924e['newRange']['isEqual'](_0x181953)))for(const {name:_0x1fc92a,data:_0x571f0f}of _0x5e8707)if(_0x181953['containsRange'](_0x571f0f['newRange'])){_0x39886f['updateMarker'](_0x1fc92a,{'range':_0x181953}),_0x3d0753=!0x0;break;}}return _0x3d0753;}),_0xed8e87['model']['document']['registerPostFixer'](_0x4ec04a=>{let _0x304e10=!0x1;const _0x356673=_0xed8e87['plugins']['get']('Users')['me'],_0x2653f4=_0x591d37['getSuggestions']()['filter'](_0x4fab36=>_0x4fab36['isInContent']&&_0x4fab36['author']==_0x356673),_0x37b75f=new Set(),_0x1c4e5d=new Set();for(const _0xf523e4 of _0x2653f4)if('tablePaste'==_0xf523e4['subType'])for(const _0x1791ba of _0xf523e4['getMarkers']()){const _0x3bd543=_0x1791ba['getRange']()['getContainedElement']();if(_0x3bd543){if(_0x3bd543['is']('element','tableCellSuggestion')&&ge(_0x3bd543)){_0xf523e4['removeMarker'](_0x1791ba['name']),_0x37b75f['add'](_0x3bd543),_0x304e10=!0x0;const _0x3e7cea=_0x3bd543['nextSibling'],_0x16ede1=_0x3bd543['previousSibling'],_0xe5010e=_0x3e7cea&&_0x3e7cea['is']('element','tableCellSuggestion'),_0x2d075c=_0x16ede1&&_0x16ede1['is']('element','tableCellSuggestion');_0xe5010e&&!_0x37b75f['has'](_0x3e7cea)&&_0x1c4e5d['add'](_0x3e7cea),_0x2d075c&&!_0x37b75f['has'](_0x16ede1)&&_0x1c4e5d['add'](_0x16ede1);}else _0x3bd543['is']('element','paragraph')&&_0x3bd543['isEmpty']&&(_0xf523e4['removeMarker'](_0x1791ba['name']),_0x304e10=!0x0);}}else{if('tablePasteCell'==_0xf523e4['subType']){if(!_0xf523e4['attributes']||!_0xf523e4['attributes']['tablePasteChainId'])continue;const _0x2e563e=_0xf523e4['attributes']['markerAttributes'];if(_0x2e563e&&Object['keys'](_0x2e563e)['length'])continue;const _0x17629c=_0xf523e4['attributes']['tablePasteChainId'];let _0x133708=!0x0,_0x4b3413=!0x0;for(const _0x3e2ccb of _0x2653f4)if(_0x3e2ccb['subType']&&_0x3e2ccb['subType']['startsWith']('tablePaste')){if(!_0x3e2ccb['attributes']['tablePasteChainId']){_0x4b3413=!0x1;break;}if(_0x3e2ccb['id']!=_0xf523e4['id']&&_0x3e2ccb['attributes']['tablePasteChainId']==_0x17629c){_0x133708=!0x1;break;}}_0x4b3413&&_0x133708&&(_0xf523e4['removeMarkers'](),_0x304e10=!0x0);}}for(const _0x4ad6f8 of _0x37b75f)_0x4ec04a['remove'](_0x4ad6f8);for(const _0x26bcd2 of _0x1c4e5d)_0x4ec04a['unwrap'](_0x26bcd2);return _0x304e10;}),_0xed8e87['conversion']['for']('editingDowncast')['markerToHighlight']({'model':'suggestion:formatBlock:tablePasteCell','view':_0x16cf53,'converterPriority':'high'}),_0xed8e87['conversion']['for']('dataDowncast')['markerToHighlight']({'model':'suggestion:formatBlock:tablePasteCell','view':(_0x465007,_0x5c8f0c)=>{if(_0x5c8f0c['options']['showSuggestionHighlights'])return _0x16cf53(_0x465007,{'showActiveMarker':!0x1});},'converterPriority':'high'});const _0x1a5949=_0xed8e87['editing']['view'];this['listenTo'](_0x1a5949['document'],'clipboardOutput',(_0x341a50,_0x29554b)=>{const _0x287b0f=[];for(const _0x368a47 of _0x1a5949['createRangeIn'](_0x29554b['content'])['getItems']())_0x368a47['is']('element','suggestion-td')&&_0x287b0f['push'](_0x368a47);_0x1a5949['change'](_0x88dafe=>{for(const _0x3189b2 of _0x287b0f)_0x88dafe['move'](_0x88dafe['createRangeIn'](_0x3189b2),_0x88dafe['createPositionBefore'](_0x3189b2)),_0x88dafe['remove'](_0x3189b2);});});}}function ge(_0x10aceb){if(_0x10aceb['isEmpty'])return!0x0;const _0x185845=_0x10aceb['getChild'](0x0);return _0x185845['is']('element','paragraph')&&_0x185845['isEmpty'];}function me(_0x25b4f7,_0x51fa16={}){for(const {isAnchor:_0x345af1,cellHeight:_0xae710c,cellWidth:_0x79909a}of new _0x3b8c6a(_0x25b4f7,{'includeAllSlots':!0x0,..._0x51fa16}))if(!_0x345af1||0x1!=_0xae710c||0x1!=_0x79909a)return!0x1;return!0x0;}