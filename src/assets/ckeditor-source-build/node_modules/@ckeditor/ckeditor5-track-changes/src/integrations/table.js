/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x166ddd}from'ckeditor5/src/core';import _0x1144db from'@ckeditor/ckeditor5-table/src/tablewalker';import{LiveRange as _0x295863}from'ckeditor5/src/engine';import{getColumnIndexes as _0x234236,getRowIndexes as _0x6f79a5,getSelectionAffectedTableCells as _0x546698}from'@ckeditor/ckeditor5-table/src/utils/selection';import'../../theme/integrations/table.css';import{setHighlightHandling as _0x28d33c}from'ckeditor5/src/widget';export default class ht extends _0x166ddd{constructor(_0x2d2515){super(_0x2d2515),this['_tablePostFixingSubtypes']=['tableRow','tableColumn'];}['afterInit'](){const _0x3225cc=this['editor'],_0x5dcc81=_0x3225cc['model']['document']['selection'];if(!_0x3225cc['plugins']['has']('TableEditing'))return;const {t:t}=_0x3225cc['locale'],_0x58baf8=_0x3225cc['plugins']['get']('TrackChangesEditing'),_0x243a18=_0x3225cc['plugins']['get']('TableUtils');_0x58baf8['_descriptionFactory']['registerElementLabel']('table',_0x1d8801=>t({'string':'table','plural':'%0\x20tables','id':'ELEMENT_TABLE'},_0x1d8801)),this['_setupColumnsRowsFixing'](),_0x58baf8['enableCommand']('insertTable'),_0x58baf8['enableCommand']('selectTableRow'),_0x58baf8['enableCommand']('selectTableColumn');for(const _0x28c6e1 of['insertTableRowAbove','insertTableRowBelow']){const _0x10e105=_0x3225cc['commands']['get'](_0x28c6e1);_0x58baf8['enableCommand'](_0x28c6e1,_0x3f2e73=>{_0x3225cc['model']['change'](_0x334c2e=>{_0x3f2e73();const _0x4e3657='above'===_0x10e105['order'],_0x1418cd=_0x546698(_0x5dcc81),_0x29f64c=_0x6f79a5(_0x1418cd),_0x11fa04=_0x4e3657?_0x29f64c['first']-0x1:_0x29f64c['last']+0x1,_0x3f471a=_0x1418cd[0x0]['findAncestor']('table'),_0x4adc21=new _0x1144db(_0x3f471a,{'startRow':_0x11fa04,'endRow':_0x11fa04}),_0x51bc0d=Array['from'](_0x4adc21)['map'](_0xe1ec8f=>_0x334c2e['createRangeOn'](_0xe1ec8f['cell']));_0x58baf8['markMultiRangeInsertion'](_0x51bc0d,'tableRow');});});}for(const _0x54f864 of['insertTableColumnLeft','insertTableColumnRight']){const _0x3ac271=_0x3225cc['commands']['get'](_0x54f864);_0x58baf8['enableCommand'](_0x54f864,_0x8da484=>{_0x3225cc['model']['change'](_0x3cd426=>{_0x8da484();const _0x1b8fb4='left'===_0x3ac271['order'],_0x45ba69=_0x546698(_0x5dcc81),_0x4fb9bb=_0x234236(_0x45ba69),_0x247110=_0x1b8fb4?_0x4fb9bb['first']-0x1:_0x4fb9bb['last']+0x1,_0x37a320=_0x45ba69[0x0]['findAncestor']('table'),_0x322e7a=new _0x1144db(_0x37a320,{'startRow':0x0,'column':_0x247110,'includeAllSlots':!0x1}),_0x551700=Array['from'](_0x322e7a)['map'](_0x1ed9c8=>_0x3cd426['createRangeOn'](_0x1ed9c8['cell']));_0x58baf8['markMultiRangeInsertion'](_0x551700,'tableColumn');});});}for(const _0x592407 of['removeTableRow','removeTableColumn']){const _0x3ea9a8=_0x592407['substr'](0xb),_0x2bfd90=_0x3ea9a8['toLowerCase'](),_0x31de02=_0x2bfd90['substr'](0x0,0x3)+'span',_0x59f3ec='table'+_0x3ea9a8,_0x44dd49='min'+_0x3ea9a8,_0x4e90d7='max'+_0x3ea9a8;_0x58baf8['enableCommand'](_0x592407,()=>{_0x3225cc['model']['change'](_0x14ce30=>{const _0xf73078=_0x546698(_0x5dcc81),_0xb77d85=_0xf73078[0x0]['findAncestor']('table');let _0x3ad7d4;if('removeTableRow'==_0x592407){const _0x41bba5=_0x6f79a5(_0xf73078);_0x3ad7d4={'startRow':_0x41bba5['first'],'endRow':_0x41bba5['last'],'includeAllSlots':!0x0};}else{const _0x2cddbc=_0x234236(_0xf73078);_0x3ad7d4={'startColumn':_0x2cddbc['first'],'endColumn':_0x2cddbc['last'],'includeAllSlots':!0x0};}const _0x2415e6=new _0x1144db(_0xb77d85,_0x3ad7d4),_0x13b458=Array['from'](_0x2415e6)['map'](({cell:_0x26e51d})=>_0x26e51d),_0xcc3eae=ue(_0x13b458['filter'](_0x278df6=>_0x278df6['hasAttribute'](_0x31de02))),_0x348dfb=ue(_0x13b458['filter'](_0xdf941f=>!_0xdf941f['hasAttribute'](_0x31de02)))['map'](_0x2a9023=>_0x14ce30['createRangeOn'](_0x2a9023)),_0x382db4=_0x58baf8['markMultiRangeDeletion'](_0x348dfb,_0x59f3ec);if(_0x382db4&&('tableRow'==_0x382db4['subType']||'tableColumn'==_0x382db4['subType'])){const _0x5c1151=this['_getSuggestionCoords'](_0x382db4);for(const _0x147b34 of _0xcc3eae){const _0x5aa6d1=_0x14ce30['createRangeOn'](_0x147b34),_0x1bdeac=_0x243a18['getCellLocation'](_0x147b34),_0x14d4f4=_0x147b34['getAttribute'](_0x31de02)-0x1,_0x2e6f17=_0x5c1151[_0x44dd49],_0x5ca9a9=_0x5c1151[_0x4e90d7];_0x2e6f17<=_0x1bdeac[_0x2bfd90]&&_0x1bdeac[_0x2bfd90]+_0x14d4f4<=_0x5ca9a9&&_0x382db4['addRange'](_0x5aa6d1);}}});});}function _0x1d6c37(_0x32ad){const _0x485108=Array['from'](_0x5dcc81['getRanges']())['map'](_0x164247=>_0x295863['fromRange'](_0x164247));_0x3225cc['model']['change'](_0xaf2d3a=>{const _0x118d16=_0xaf2d3a['batch'];_0x32ad=_0x32ad['filter'](_0x5b24e3=>'$graveyard'!=_0x5b24e3['root']['rootName']),_0xaf2d3a['setSelection'](_0x32ad),_0x3225cc['commands']['get']('removeTableRow')['refresh'](),_0x3225cc['execute']('removeTableRow',{'forceDefaultExecution':!0x0}),_0x3225cc['model']['enqueueChange'](()=>{_0x3225cc['model']['enqueueChange'](_0x118d16,_0x31d060=>{const _0x53942f=_0x485108['filter'](_0x3d74df=>'$graveyard'!=_0x3d74df['root']['rootName']);_0x53942f['length']>0x0&&_0x31d060['setSelection'](_0x53942f);for(const _0x108f19 of _0x485108)_0x108f19['detach']();});});});}function _0x4d7134(_0x1517cb){_0x3225cc['model']['change'](_0x4b114f=>{const _0x58f230=Array['from'](_0x5dcc81['getRanges']())['map'](_0x21f5c0=>_0x295863['fromRange'](_0x21f5c0)),_0x16e098=[];for(const _0x56e16d of _0x1517cb)for(const _0x35283f of _0x56e16d['getItems']({'shallow':!0x0}))_0x16e098['push'](_0x35283f);for(const _0x33250e of _0x16e098)'$graveyard'!=_0x33250e['root']['rootName']&&(_0x4b114f['setSelection'](_0x4b114f['createPositionAt'](_0x33250e,0x0)),_0x3225cc['commands']['get']('removeTableColumn')['refresh'](),_0x3225cc['execute']('removeTableColumn',{'forceDefaultExecution':!0x0}));const _0x2d0879=_0x58f230['filter'](_0x4f80fc=>'$graveyard'!=_0x4f80fc['root']['rootName']);_0x2d0879['length']>0x0&&_0x4b114f['setSelection'](_0x2d0879);for(const _0x342178 of _0x58f230)_0x342178['detach']();});}function _0x2be687(_0x3defc6,_0x5bffd0){return _0x5bffd0['every'](_0x290084=>_0x3defc6['some'](_0x1990be=>_0x1990be['end']['isEqual'](_0x290084['start'])||_0x290084['end']['isEqual'](_0x1990be['start'])));}function _0x1b0e0b(_0x5df0b8,_0x20a796){return _0x5df0b8['some'](_0x57d707=>_0x20a796['some'](_0xc6a8e6=>_0x57d707['end']['isTouching'](_0xc6a8e6['start'])));}_0x3225cc['data']['downcastDispatcher']['on']('addMarker:suggestion',(_0x19b258,_0x30a3d9,_0x4fd03b)=>{if(!_0x4fd03b['options']['showSuggestionHighlights'])return;const _0x133061=_0x30a3d9['item'];if(!_0x133061)return;const _0x530b2a=_0x4fd03b['mapper']['toViewElement'](_0x133061);function _0x18175b(_0x507e05){return Array['isArray'](_0x507e05)?_0x507e05:[_0x507e05];}_0x530b2a&&'tableCell'===_0x133061['name']&&_0x28d33c(_0x530b2a,_0x4fd03b['writer'],(_0xb2ff7e,_0x5a3e10,_0x3f44ce)=>_0x3f44ce['addClass'](_0x18175b(_0x5a3e10['classes']),_0xb2ff7e),(_0x2c33f9,_0x2e682f,_0x9fcff3)=>_0x9fcff3['removeClass'](_0x18175b(_0x2e682f['classes']),_0x2c33f9));},{'priority':'highest'}),_0x58baf8['_descriptionFactory']['registerDescriptionCallback'](_0x38f62e=>{if('insertion'!=_0x38f62e['type']&&'deletion'!=_0x38f62e['type'])return;const _0x51e631=_0x38f62e['getContainedElement']();if(null!=_0x51e631&&_0x51e631['is']('element','table')){if('insertion'==_0x38f62e['type']){const _0x2e9ee7=_0x38f62e['getItems']()['filter'](_0x5279b0=>_0x5279b0['is']('textProxy'))['map'](_0x32c628=>_0x32c628['data']);if(_0x2e9ee7['length'])return{'type':'insertion','content':t('*Insert:*\x20%0',t({'string':'table\x20*with\x20text*\x20%0','id':'ELEMENT_TABLE_WITH_TEXT'},'\x22'+_0x2e9ee7['join']('\x20')+'\x22'))};}if('deletion'==_0x38f62e['type']){const _0x1bb431=_0x38f62e['getItems']()['filter'](_0xb2fc6d=>_0xb2fc6d['is']('textProxy'))['map'](_0x593a53=>_0x593a53['data']);if(_0x1bb431['length'])return{'type':'deletion','content':t('*Remove:*\x20%0',t({'string':'table\x20*with\x20text*\x20%0','id':'ELEMENT_TABLE_WITH_TEXT'},'\x22'+_0x1bb431['join']('\x20')+'\x22'))};}}}),_0x58baf8['_descriptionFactory']['registerDescriptionCallback'](_0x4ef1c7=>{if('tableRow'==_0x4ef1c7['subType']){const _0x552851=_0x4ef1c7['getItems']()['filter'](_0xdf80ab=>_0xdf80ab['is']('textProxy'))['map'](_0x4bb622=>_0x4bb622['data']),_0x4dc7f8=this['_getSuggestionCoords'](_0x4ef1c7),_0x1d669f=_0x4dc7f8['maxRow']-_0x4dc7f8['minRow']+0x1;if('insertion'==_0x4ef1c7['type'])return _0x552851['length']?{'type':'insertion','content':t('*Insert:*\x20%0',t({'string':'table\x20row\x20*with\x20text*\x20%1','plural':'%0\x20table\x20rows\x20*with\x20text*\x20%1','id':'ELEMENT_TABLE_ROW_WITH_TEXT'},[_0x1d669f,'\x22'+_0x552851['join']('\x20')+'\x22']))}:{'type':'insertion','content':t('*Insert:*\x20%0',t({'string':'table\x20row','plural':'%0\x20table\x20rows','id':'ELEMENT_TABLE_ROW'},_0x1d669f))};if('deletion'==_0x4ef1c7['type'])return _0x552851['length']?{'type':'deletion','content':t('*Remove:*\x20%0',t({'string':'table\x20row\x20*with\x20text*\x20%1','plural':'%0\x20table\x20rows\x20*with\x20text*\x20%1','id':'ELEMENT_TABLE_ROW_WITH_TEXT'},[_0x1d669f,'\x22'+_0x552851['join']('\x20')+'\x22']))}:{'type':'deletion','content':t('*Remove:*\x20%0',t({'string':'table\x20row','plural':'%0\x20table\x20rows','id':'ELEMENT_TABLE_ROW'},_0x1d669f))};}if('tableColumn'==_0x4ef1c7['subType']){const _0x4f89cf=_0x4ef1c7['getItems']()['filter'](_0x559738=>_0x559738['is']('textProxy'))['map'](_0x2f3108=>_0x2f3108['data']),_0x5edb3b=this['_getSuggestionCoords'](_0x4ef1c7),_0x173e5b=_0x5edb3b['maxColumn']-_0x5edb3b['minColumn']+0x1;if('insertion'==_0x4ef1c7['type'])return _0x4f89cf['length']?{'type':'insertion','content':t('*Insert:*\x20%0',t({'string':'table\x20column\x20*with\x20text*\x20%1','plural':'%0\x20table\x20columns\x20*with\x20text*\x20%1','id':'ELEMENT_TABLE_COLUMN_WITH_TEXT'},[_0x173e5b,'\x22'+_0x4f89cf['join']('\x20')+'\x22']))}:{'type':'insertion','content':t('*Insert:*\x20%0',t({'string':'table\x20column','plural':'%0\x20table\x20columns','id':'ELEMENT_TABLE_COLUMN'},_0x173e5b))};if('deletion'==_0x4ef1c7['type'])return _0x4f89cf['length']?{'type':'deletion','content':t('*Remove:*\x20%0',t({'string':'table\x20column\x20*with\x20text*\x20%1','plural':'%0\x20table\x20columns\x20*with\x20text*\x20%1','id':'ELEMENT_TABLE_COLUMN_WITH_TEXT'},[_0x173e5b,'\x22'+_0x4f89cf['join']('\x20')+'\x22']))}:{'type':'deletion','content':t('*Remove:*\x20%0',t({'string':'table\x20column','plural':'%0\x20table\x20columns','id':'ELEMENT_TABLE_COLUMN'},_0x173e5b))};}}),_0x58baf8['_suggestionFactory']['registerCustomCallback']('insertion','tableRow','discard',_0x1d6c37),_0x58baf8['_suggestionFactory']['registerCustomCallback']('deletion','tableRow','accept',_0x1d6c37),_0x58baf8['_suggestionFactory']['registerCustomCallback']('insertion','tableColumn','discard',_0x4d7134),_0x58baf8['_suggestionFactory']['registerCustomCallback']('deletion','tableColumn','accept',_0x4d7134),_0x58baf8['_suggestionFactory']['registerCustomCallback']('insertion','tableColumn','join',_0x2be687),_0x58baf8['_suggestionFactory']['registerCustomCallback']('deletion','tableColumn','join',_0x2be687),_0x58baf8['_suggestionFactory']['registerCustomCallback']('insertion','tableRow','join',_0x1b0e0b),_0x58baf8['_suggestionFactory']['registerCustomCallback']('deletion','tableRow','join',_0x1b0e0b);}['_acceptFormatSuggestionCallbackFactory'](){const _0x1acda7=this['editor'],_0x2d3bfa=_0x1acda7['model']['document']['selection'];return(_0x1d6c64,_0x5a49b1)=>{_0x1acda7['model']['change'](_0x224048=>{const {commandName:_0x50e33a,commandParams:_0x247ee2}=_0x5a49b1;let _0x37f954=_0x1d6c64[0x0]['end']['nodeBefore'];_0x247ee2&&_0x247ee2[0x0]&&!0x1===_0x247ee2[0x0]['forceValue']&&(_0x37f954=_0x1d6c64[0x0]['start']['nodeAfter']);const _0x24657a=_0x224048['createRangeIn'](_0x37f954);if('$graveyard'==_0x24657a['root']['rootName'])return;const _0x10b325=Array['from'](_0x2d3bfa['getRanges']())['map'](_0x1a47f1=>_0x295863['fromRange'](_0x1a47f1));_0x224048['setSelection'](_0x24657a),_0x1acda7['commands']['get'](_0x50e33a)['refresh'](),_0x247ee2['push']({'forceDefaultExecution':!0x0}),_0x1acda7['execute'](_0x50e33a,..._0x247ee2);const _0x121d97=_0x10b325['filter'](_0x408a99=>'$graveyard'!=_0x408a99['root']['rootName']);_0x121d97['length']>0x0&&_0x224048['setSelection'](_0x121d97);for(const _0x4b1e9e of _0x10b325)_0x4b1e9e['detach']();});};}['_getCoordsForCells'](_0x16c38b){const _0x2d24f6=this['editor']['plugins']['get']('TableUtils');let _0x525162=Number['MAX_SAFE_INTEGER'],_0x417a4f=Number['MIN_SAFE_INTEGER'],_0x1c92c3=Number['MAX_SAFE_INTEGER'],_0x31fad8=Number['MIN_SAFE_INTEGER'];for(const _0x17a332 of _0x16c38b){if('$graveyard'==_0x17a332['root']['rootName'])continue;const {row:_0x557236,column:_0x5cb1c0}=_0x2d24f6['getCellLocation'](_0x17a332),_0x3cbcf1=_0x17a332['hasAttribute']('rowspan')?_0x17a332['getAttribute']('rowspan')-0x1:0x0,_0x2d841d=_0x17a332['hasAttribute']('colspan')?_0x17a332['getAttribute']('colspan')-0x1:0x0;_0x525162=_0x557236<_0x525162?_0x557236:_0x525162,_0x417a4f=_0x557236+_0x3cbcf1>_0x417a4f?_0x557236+_0x3cbcf1:_0x417a4f,_0x1c92c3=_0x5cb1c0<_0x1c92c3?_0x5cb1c0:_0x1c92c3,_0x31fad8=_0x5cb1c0+_0x2d841d>_0x31fad8?_0x5cb1c0+_0x2d841d:_0x31fad8;}return{'minRow':_0x525162,'maxRow':_0x417a4f,'minColumn':_0x1c92c3,'maxColumn':_0x31fad8};}['_setupColumnsRowsFixing'](){const _0x4037c1=this['editor'],_0x4d8c08=_0x4037c1['plugins']['get']('TrackChangesEditing'),_0x3bef89=_0x4037c1['plugins']['get']('TableUtils');this['_tableSuggestions']=new Set(),_0x4037c1['model']['document']['on']('change:data',()=>{const _0x25ed5e=Array['from'](_0x4037c1['model']['document']['differ']['getChangedMarkers']());for(const {name:_0x3a38b8,data:_0xa2d3f9}of _0x25ed5e){const {group:_0x244bc6,id:_0x369bf6,subType:_0x2af43c}=_0x4d8c08['_splitMarkerName'](_0x3a38b8);if('suggestion'!=_0x244bc6)continue;if(null!=_0xa2d3f9['oldRange'])continue;const _0x5ddb6a=_0x4d8c08['getSuggestion'](_0x369bf6);this['_tablePostFixingSubtypes']['includes'](_0x2af43c)&&this['_tableSuggestions']['add'](_0x5ddb6a);}},{'priority':'low'});const _0x374c4e=(_0x280ab9,_0xb261ff)=>{let _0x1a8c71=!0x1;const _0x1a484c=_0xb261ff['createRangeOn'](_0x280ab9),_0xa6483c=_0x280ab9['findAncestor']('table'),_0x39fb2b=_0x3bef89['getCellLocation'](_0x280ab9);for(const _0x596ca8 of this['_tableSuggestions']){const _0x130b2e=_0x596ca8['subType'],_0x385c9e=_0x130b2e['startsWith']('tablePaste'),_0x1a820e=_0x130b2e['substr'](_0x385c9e?0xa:0x5),_0x47f65d=_0x1a820e['toLowerCase'](),_0x23423c=_0x47f65d['substr'](0x0,0x3)+'span',_0x2365d8='min'+_0x1a820e,_0x5d8ce7='max'+_0x1a820e;if(!_0x596ca8['isInContent'])continue;if(_0xa6483c!=_0x596ca8['getFirstRange']()['start']['findAncestor']('table'))continue;if(_0x596ca8['isIntersectingWithRange'](_0x1a484c))continue;const _0x3036f3=_0x280ab9['hasAttribute'](_0x23423c)?_0x280ab9['getAttribute'](_0x23423c)-0x1:0x0,_0x277195=this['_getSuggestionCoords'](_0x596ca8),_0x14eabd=_0x277195[_0x2365d8],_0x2b13d0=_0x277195[_0x5d8ce7];_0x14eabd<=_0x39fb2b[_0x47f65d]&&_0x39fb2b[_0x47f65d]+_0x3036f3<=_0x2b13d0&&(_0x596ca8['addRange'](_0x1a484c),_0x1a8c71=!0x0);}return _0x1a8c71;};_0x4037c1['model']['document']['registerPostFixer'](_0x519d9b=>{let _0x1d733d=!0x1;for(const _0x2551d5 of _0x4037c1['model']['document']['differ']['getChanges']())if('insert'==_0x2551d5['type']){if('tableRow'==_0x2551d5['name'])for(const _0x5071c4 of _0x2551d5['position']['nodeAfter']['getChildren']())_0x1d733d=_0x1d733d||_0x374c4e(_0x5071c4,_0x519d9b);else'tableCell'==_0x2551d5['name']&&(_0x1d733d=_0x1d733d||_0x374c4e(_0x2551d5['position']['nodeAfter'],_0x519d9b));}return _0x1d733d;});}['_getSuggestionCoords'](_0x1ab128){return this['_getCoordsForCells'](_0x1ab128['getRanges']()['map'](_0x33775f=>_0x33775f['start']['nodeAfter']));}}function ue(_0x3a281e){return Array['from'](new Set(_0x3a281e)['values']());}