/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x366f31}from'ckeditor5/src/core';import{LivePosition as te}from'ckeditor5/src/engine';import{uid as _0x236ba6}from'ckeditor5/src/utils';import{getCaptionFromImageModelElement as _0x51443d}from'@ckeditor/ckeditor5-image/src/imagecaption/utils';import'../../theme/integrations/image.css';export default class V extends _0x366f31{['afterInit'](){const _0x1fa6a3=this['editor'];if(!_0x1fa6a3['plugins']['has']('ImageEditing'))return;const _0x10823f=_0x1fa6a3['plugins']['get']('TrackChangesEditing'),_0x34af2=_0x1fa6a3['plugins']['get']('ImageUtils'),_0x999d63={},{t:t}=_0x1fa6a3['locale'];if(_0x10823f['enableCommand']('insertImage'),_0x10823f['_descriptionFactory']['registerElementLabel']('imageBlock',_0x234801=>t({'string':'image','plural':'%0\x20images','id':'ELEMENT_IMAGE'},_0x234801)),_0x10823f['_descriptionFactory']['registerElementLabel']('imageInline',_0x4381e1=>t({'string':'image','plural':'%0\x20images','id':'ELEMENT_INLINE_IMAGE'},_0x4381e1)),_0x10823f['_descriptionFactory']['registerElementLabel']('caption',t({'string':'caption','id':'ELEMENT_CAPTION'})),_0x1fa6a3['plugins']['has']('ImageUploadEditing')&&_0x10823f['enableCommand']('uploadImage'),_0x1fa6a3['plugins']['has']('ImageBlockEditing')&&_0x1fa6a3['plugins']['has']('ImageInlineEditing')&&(_0x10823f['enableCommand']('imageTypeInline',(_0x3c92d3,_0xcde06b)=>{const _0x305085=_0x34af2['getClosestSelectedImageElement'](_0x1fa6a3['model']['document']['selection']);_0x1fa6a3['model']['change'](()=>{_0x10823f['markBlockFormat'](_0x305085,{'commandName':'imageTypeInline','commandParams':[_0xcde06b]},[],'convertBlockImageToInline');});}),_0x10823f['enableCommand']('imageTypeBlock',(_0x326c08,_0x24a7bf)=>{_0x1fa6a3['model']['change'](_0x5e4442=>{let _0x139291=_0x34af2['getClosestSelectedImageElement'](_0x1fa6a3['model']['document']['selection']),_0x324d61=_0x5e4442['createRangeOn'](_0x139291);const _0x377c9a=te['fromPosition'](_0x324d61['start'],'toPrevious'),_0x3473bf=te['fromPosition'](_0x324d61['end'],'toNext');_0x10823f['forceDefaultExecution'](()=>_0x326c08(_0x24a7bf)),_0x139291=_0x34af2['getClosestSelectedImageElement'](_0x1fa6a3['model']['document']['selection']),_0x324d61=_0x5e4442['createRangeOn'](_0x139291);const _0x15bfab=_0x5e4442['createRange'](_0x377c9a,_0x3473bf);_0x377c9a['detach'](),_0x3473bf['detach'](),_0x10823f['markBlockFormat'](_0x139291,{'commandName':'imageTypeInline'},[],'convertInlineImageToBlock'),_0x15bfab['start']['isBefore'](_0x324d61['start'])&&_0x10823f['markInsertion'](_0x5e4442['createRange'](_0x15bfab['start'],_0x324d61['start']),'convertInlineImageToBlock'),_0x324d61['end']['isBefore'](_0x15bfab['end'])&&_0x10823f['markInsertion'](_0x5e4442['createRange'](_0x324d61['end'],_0x15bfab['end']),'convertInlineImageToBlock');});}),_0x10823f['_suggestionFactory']['registerCustomCallback']('formatBlock','convertInlineImageToBlock','join',()=>{}),_0x10823f['_suggestionFactory']['registerCustomCallback']('formatBlock','convertInlineImageToBlock','accept',()=>{}),_0x10823f['_suggestionFactory']['registerCustomCallback']('formatBlock','convertInlineImageToBlock','discard',_0x10823f['_suggestionFactory']['getSuggestionCallback']('formatBlock','','accept')),_0x10823f['_suggestionFactory']['registerCustomCallback']('insertion','convertInlineImageToBlock','join',()=>{}),_0x10823f['_suggestionFactory']['registerCustomCallback']('insertion','convertInlineImageToBlock','discard',([_0x540cc2])=>{const _0x195feb=_0x10823f['_suggestionFactory']['getSuggestionCallback']('insertion','','discard');let _0x41e06c=_0x540cc2['start'],_0x302c81=_0x540cc2['end'];const _0x2f128b=_0x1fa6a3['model']['schema']['getNearestSelectionRange'](_0x41e06c,'backward'),_0x38d185=_0x1fa6a3['model']['schema']['getNearestSelectionRange'](_0x302c81,'forward');_0x2f128b['isCollapsed']&&(_0x41e06c=_0x2f128b['start']),_0x38d185['isCollapsed']&&(_0x302c81=_0x38d185['end']),_0x195feb([_0x1fa6a3['model']['createRange'](_0x41e06c,_0x302c81)]);}),_0x10823f['_suggestionFactory']['registerCustomCallback']('formatBlock','convertInlineImageToBlock','chain',_0x2daf3e),_0x10823f['_suggestionFactory']['registerCustomCallback']('insertion','convertInlineImageToBlock','chain',_0x2daf3e)),_0x1fa6a3['plugins']['has']('ImageCaptionEditing')&&(_0x10823f['enableCommand']('toggleImageCaption',(_0x148b76,_0x19a05f)=>{let _0x170f78=_0x34af2['getClosestSelectedImageElement'](_0x1fa6a3['model']['document']['selection']),_0x4c9a43=_0x51443d(_0x170f78);_0x1fa6a3['model']['change'](()=>{if(_0x4c9a43)return void _0x10823f['markDeletion'](_0x1fa6a3['model']['createRangeOn'](_0x4c9a43));const _0x2c20ba=_0x34af2['isBlockImage'](_0x170f78);_0x148b76(_0x19a05f),_0x170f78=_0x34af2['getClosestSelectedImageElement'](_0x1fa6a3['model']['document']['selection']),_0x4c9a43=_0x51443d(_0x170f78),_0x10823f['markInsertion'](_0x1fa6a3['model']['createRangeOn'](_0x4c9a43),_0x2c20ba?null:'imageCaption');});}),_0x10823f['_suggestionFactory']['registerCustomCallback']('insertion','imageCaption','chain',_0x2daf3e)),_0x1fa6a3['plugins']['has']('ImageStyleEditing')){_0x10823f['enableCommand']('imageStyle',(_0x1b121b,_0xf0a0fd)=>{const _0x2a3a21=_0x1fa6a3['plugins']['get']('Users')['me'],_0x238034=_0x1fa6a3['commands']['get']('imageStyle');let _0x189d74=_0x34af2['getClosestSelectedImageElement'](_0x1fa6a3['model']['document']['selection']),_0x35a2f0=_0x1fa6a3['model']['createRangeOn'](_0x189d74),_0x47f2d7=_0x238034['value'];if(_0x47f2d7==_0xf0a0fd['value'])return;const _0x4da482={'commandName':'imageStyle','commandParams':[_0xf0a0fd],'formatGroupId':_0x236ba6()};_0x1fa6a3['model']['change'](()=>{if(_0x10823f['getSuggestions']()['filter'](_0x3b123b=>_0x3b123b['isInContent']&&_0x2a3a21==_0x3b123b['author']&&('formatBlock'==_0x3b123b['type']||'formatInline'==_0x3b123b['type'])&&('imageStylePreApply'==_0x3b123b['subType']||'imageStylePostApply'==_0x3b123b['subType'])&&_0x3b123b['getFirstRange']()['isEqual'](_0x35a2f0))['forEach'](_0x49bafa=>_0x10823f['discardSuggestion'](_0x49bafa['head'])),_0x189d74=_0x34af2['getClosestSelectedImageElement'](_0x1fa6a3['model']['document']['selection']),_0x35a2f0=_0x1fa6a3['model']['createRangeOn'](_0x189d74),_0x238034['refresh'](),_0x1fa6a3['commands']['get']('imageTypeInline')['refresh'](),_0x1fa6a3['commands']['get']('imageTypeBlock')['refresh'](),_0x47f2d7=_0x238034['value'],_0x47f2d7!=_0xf0a0fd['value'])return _0x34af2['isInlineImage'](_0x189d74)&&_0x238034['shouldConvertImageType'](_0xf0a0fd['value'],_0x189d74)?(_0x1b121b(_0xf0a0fd),_0x189d74=_0x34af2['getClosestSelectedImageElement'](_0x1fa6a3['model']['document']['selection']),void _0x10823f['markBlockFormat'](_0x189d74,{..._0x4da482,'commandReversedParams':[{'value':_0x47f2d7||null}]},[],'imageStylePreApply')):void(_0x34af2['isBlockImage'](_0x189d74)?_0x10823f['markBlockFormat'](_0x189d74,_0x4da482,[],'imageStylePostApply'):_0x10823f['markInlineFormat'](_0x35a2f0,_0x4da482,'imageStylePostApply'));});});for(const _0x41c5d2 of _0x1fa6a3['plugins']['get']('ImageStyleEditing')['normalizedStyles'])_0x999d63[_0x41c5d2['name']]=_0x41c5d2['title']['toLowerCase']();_0x10823f['_suggestionFactory']['registerCustomCallback']('formatBlock','imageStylePreApply','join',()=>{}),_0x10823f['_suggestionFactory']['registerCustomCallback']('formatBlock','imageStylePostApply','join',()=>{}),_0x10823f['_suggestionFactory']['registerCustomCallback']('formatInline','imageStylePostApply','join',()=>{}),_0x10823f['_suggestionFactory']['registerCustomCallback']('formatBlock','imageStylePreApply','accept',()=>{}),_0x10823f['_suggestionFactory']['registerCustomCallback']('formatBlock','imageStylePreApply','discard',(_0x365f39,_0x2941f6)=>{_0x10823f['_suggestionFactory']['getSuggestionCallback']('formatBlock','','accept')(_0x365f39,{'commandName':_0x2941f6['commandName'],'commandParams':_0x2941f6['commandReversedParams']});}),_0x10823f['_suggestionFactory']['registerCustomCallback']('formatBlock','imageStylePreApply','chain',_0x2daf3e);}const _0x15464e=[{'type':'formatBlock','subType':'imageStylePreApply'},{'type':'insertion','subType':'imageCaption'},{'type':'formatBlock','subType':'convertInlineImageToBlock'},{'type':'insertion','subType':'convertInlineImageToBlock'}];function _0x33ba78(_0x4200e4,_0x171eb5){const _0x2666be=_0x15464e['findIndex'](({type:_0x277d1d,subType:_0x11d005})=>_0x4200e4['type']==_0x277d1d&&_0x4200e4['subType']==_0x11d005),_0x4411c0=_0x15464e['findIndex'](({type:_0x199eac,subType:_0x2b3031})=>_0x171eb5['type']==_0x199eac&&_0x171eb5['subType']==_0x2b3031);if(_0x2666be<0x0||_0x4411c0<0x0)return!0x1;const _0x41f241=_0x4200e4['getFirstRange'](),_0x3d88e4=_0x171eb5['getFirstRange']();if((0x0==_0x2666be||0x1==_0x2666be)&&0x2==_0x4411c0&&_0x41f241['isIntersecting'](_0x3d88e4))return!0x0;if(0x2==_0x2666be&&0x3==_0x4411c0){const _0xa6a1c4=_0x10823f['_findSuggestions'](_0x41f241,'insertion')['filter'](({suggestion:_0x533a56,meta:_0x47f3fd})=>_0x47f3fd['isOwn']&&'convertInlineImageToBlock'==_0x533a56['subType']);if(_0xa6a1c4['length']>0x1&&_0x3d88e4['end']['isEqual'](_0x41f241['start']))return!0x0;if(0x1==_0xa6a1c4['length']&&(_0x41f241['start']['isEqual'](_0x3d88e4['end'])||_0x41f241['end']['isEqual'](_0x3d88e4['start'])))return!0x0;}if(0x3==_0x2666be&&0x3==_0x4411c0&&_0x41f241['start']['isBefore'](_0x3d88e4['start'])){const _0x4c9203=_0x41f241['end']['nodeAfter'],_0x45b313=_0x3d88e4['start']['nodeBefore'];return _0x34af2['isBlockImage'](_0x4c9203)&&_0x4c9203===_0x45b313;}return!0x1;}function _0x2daf3e(_0x238e87,_0x4e794d){return _0x33ba78(_0x238e87,_0x4e794d)?[_0x238e87,_0x4e794d]:_0x33ba78(_0x4e794d,_0x238e87)?[_0x4e794d,_0x238e87]:null;}_0x1fa6a3['model']['document']['registerPostFixer'](()=>{let _0x519e5e=!0x1;const _0x15c89b=Array['from'](_0x1fa6a3['model']['document']['differ']['getChangedMarkers']());for(const {name:_0x370126,data:_0x95eee3}of _0x15c89b){const {group:_0x5355b3,type:_0x385494,subType:_0x21e6a8,id:_0x454618}=_0x10823f['_splitMarkerName'](_0x370126);if('suggestion'==_0x5355b3&&_0x10823f['hasSuggestion'](_0x454618)){if('formatBlock'==_0x385494&&('imageStylePreApply'==_0x21e6a8||'imageStylePostApply'==_0x21e6a8)){const _0x23c638=_0x10823f['getSuggestion'](_0x454618);if(_0x95eee3['newRange']){const _0xab53c2=_0x23c638['getFirstRange']()['getContainedElement']();if(_0x34af2['isBlockImage'](_0xab53c2))continue;_0x10823f['discardSuggestion'](_0x23c638),_0x519e5e=!0x0;}}if('insertion'==_0x385494&&'imageCaption'==_0x21e6a8&&!_0x95eee3['newRange']){const _0x3457ae=_0x10823f['getSuggestion'](_0x454618);_0x3457ae['next']&&_0x3457ae['next']['isInContent']&&(_0x10823f['discardSuggestion'](_0x3457ae['next']),_0x519e5e=!0x0);}}}return _0x519e5e;}),_0x1fa6a3['plugins']['has']('ImageResize')&&_0x10823f['enableCommand']('resizeImage',(_0x2764db,_0x3c1ada)=>{const _0x414d26=_0x34af2['getClosestSelectedImageElement'](_0x1fa6a3['model']['document']['selection']);_0x414d26['getAttribute']('width')!=_0x3c1ada['width']&&_0x1fa6a3['model']['change'](()=>{_0x10823f['markBlockFormat'](_0x414d26,{'commandName':'resizeImage','commandParams':[_0x3c1ada]});});}),_0x1fa6a3['plugins']['has']('ImageTextAlternativeEditing')&&_0x10823f['enableCommand']('imageTextAlternative',(_0x48c1bd,_0x6c1d71)=>{const _0xf87f3b=_0x34af2['getClosestSelectedImageElement'](_0x1fa6a3['model']['document']['selection']);(_0xf87f3b['hasAttribute']('alt')?_0xf87f3b['getAttribute']('alt'):'')!=_0x6c1d71['newValue']&&_0x1fa6a3['model']['change'](()=>{_0x10823f['markBlockFormat'](_0xf87f3b,{'commandName':'imageTextAlternative','commandParams':[_0x6c1d71]});});}),_0x10823f['_descriptionFactory']['registerDescriptionCallback'](_0x5cb408=>{if(!!_0x15464e['find'](({type:_0xbf7f35,subType:_0x524444})=>_0x5cb408['type']==_0xbf7f35&&_0x5cb408['subType']==_0x524444))return _0x5cb408['previous']?{}:void 0x0;}),_0x10823f['_descriptionFactory']['registerDescriptionCallback'](_0x329347=>{if('insertion'==_0x329347['type']||'deletion'==_0x329347['type']){const _0x19bee6=_0x329347['getContainedElement']();if(_0x19bee6&&_0x19bee6['is']('element','caption'))return{'type':'insertion'==_0x329347['type']?'addObject':'removeObject','name':_0x19bee6['name'],'quantity':0x1};}}),_0x10823f['_descriptionFactory']['registerDescriptionCallback'](_0x5c1a5e=>'formatBlock'==_0x5c1a5e['type']&&'convertInlineImageToBlock'==_0x5c1a5e['subType']?{'type':'format','content':'Inline\x20image\x20to\x20block\x20image'}:'formatBlock'==_0x5c1a5e['type']&&'convertBlockImageToInline'==_0x5c1a5e['subType']?{'type':'format','content':'Block\x20image\x20to\x20inline\x20image'}:void 0x0),_0x10823f['_descriptionFactory']['registerDescriptionCallback'](_0x477765=>{const {data:_0x482c51}=_0x477765;if(_0x482c51){if('imageStyle'==_0x482c51['commandName']){const _0x5a1f4c=_0x482c51['commandParams'][0x0]['value'];return _0x1ee4a5('side'===_0x5a1f4c?t({'string':'side\x20image','id':'FORMAT_SIDE_IMAGE'}):_0x999d63[_0x5a1f4c]||_0x5a1f4c);}if('imageTextAlternative'==_0x482c51['commandName']){const _0x10af19=_0x482c51['commandParams'][0x0]['newValue'];return _0x10af19?{'type':'format','content':t('*Set\x20image\x20text\x20alternative:*\x20%0','\x22'+_0x10af19+'\x22')}:{'type':'format','content':t('*Remove\x20image\x20text\x20alternative*')};}if('resizeImage'==_0x482c51['commandName']){const _0x355576=_0x482c51['commandParams'][0x0]['width'];return _0x355576?{'type':'format','content':t('*Set\x20image\x20width:*\x20%0',_0x355576)}:{'type':'format','content':t('*Reset\x20image\x20width*')};}}function _0x1ee4a5(_0x1f6abb){return{'type':'format','content':t('*Format:*\x20%0',_0x1f6abb)};}});}}