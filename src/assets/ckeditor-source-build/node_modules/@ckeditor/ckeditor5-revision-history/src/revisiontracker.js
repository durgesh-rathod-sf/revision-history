/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import _0x494f7c from'@ckeditor/ckeditor5-collaboration-core/src/users';import _0x1da2d9 from'@ckeditor/ckeditor5-core/src/plugin';import _0x5463f8 from'@ckeditor/ckeditor5-core/src/pendingactions';import _0x33daea from'@ckeditor/ckeditor5-engine/src/model/position';import _0x2a55e5 from'@ckeditor/ckeditor5-engine/src/model/range';import _0x305e8f from'@ckeditor/ckeditor5-engine/src/model/documentfragment';import{_insert as _0xe4f163,_setAttribute as _0x3eeba6}from'@ckeditor/ckeditor5-engine/src/model/operation/utils';import _0x1513a4 from'./revisionsrepository';import _0x14fd22 from'@ckeditor/ckeditor5-engine/src/view/documentfragment';import _0x19527d from'@ckeditor/ckeditor5-engine/src/view/text';import _0x3c439f from'@ckeditor/ckeditor5-engine/src/view/element';import{uid as _0xa10f41}from'ckeditor5/src/utils';export default class u extends _0x1da2d9{static get['pluginName'](){return'RevisionTracker';}static get['requires'](){return[_0x494f7c,_0x1513a4,_0x5463f8];}constructor(..._0x469798){super(..._0x469798),this['adapter']=null,this['set']('isReady',!0x1),this['set']('isEnabled',!0x0),this['currentRevision']=null;const _0x465d03=_0xa10f41();this['_source']={'history':this['editor']['model']['document']['history'],'getLatestVersion':()=>Promise['resolve'](this['editor']['model']['document']['version']),'getCurrentRevisionId':()=>_0x465d03},this['_revisionDataBuilder']=new V(this['editor']),this['_initialRevisionId']=this['editor']['config']['get']('collaboration.channelId')||'initial',this['set']('isPendingUpdate',!0x1),this['_bufferedUpdates']=new Map();}['init'](){this['repository']=this['editor']['plugins']['get']('RevisionsRepository'),this['_setConversion'](),this['editor']['data']['on']('ready',()=>{if(this['editor']['plugins']['has']('RealTimeCollaborationClient')){const _0x1d41dc=this['_source']['getCurrentRevisionId'](),_0x25b219=this['repository']['getRevision'](_0x1d41dc);this['_startingVersion']=_0x25b219?_0x25b219['fromVersion']:this['_source']['history']['_operations'][this['_source']['history']['_operations']['length']-0x1]['baseVersion']+0x1;}else{const _0x223565=this['repository']['getRevisions']()['find'](_0x10cab7=>null===_0x10cab7['creator']);if(_0x223565){if(this['editor']['model']['document']['version']=_0x223565['toVersion'],_0x223565['fromVersion']===_0x223565['toVersion'])this['_source']['getCurrentRevisionId']=()=>_0x223565['id'];else{const _0x117845=this['editor']['plugins']['get']('Users')['me'];_0x223565['creator']=_0x117845,_0x223565['_update']({'creatorId':_0x117845['id']});}}this['_startingVersion']=this['editor']['model']['document']['version'];}this['_revisionDataBuilder']['init'](this['_source']['history']),this['_createInitialRevision'](this['_startingVersion']),this['_createCurrentRevision'](this['_startingVersion']),this['adapter']&&this['sendBufferedUpdates']();}),this['bind']('isReady')['to'](this,'_isPendingUpdate',_0x572237=>!_0x572237);}['setSource'](_0x263b72){this['_source']=_0x263b72;}async['update'](){const _0x45483f=await this['_source']['getLatestVersion']();if(_0x45483f>this['currentRevision']['toVersion']){const _0x25ebb3=this['buildRevisionData']({'revision':this['currentRevision'],'to':_0x45483f});_0x25ebb3['authors']=_0x25ebb3['authorsIds']['map'](_0x2d57f3=>this['editor']['plugins']['get']('Users')['getUser'](_0x2d57f3)),this['currentRevision']['_update'](_0x25ebb3);}}async['saveRevision'](_0x3b1b1a={},_0x4608dd=null){const _0x2a5ef9=[];if(_0x4608dd>this['currentRevision']['toVersion']&&(_0x4608dd=null),null===_0x4608dd&&(_0x4608dd=await this['_source']['getLatestVersion']()),this['currentRevision']['toVersion']<_0x4608dd){const _0x482f00=this['buildRevisionData']({'revision':this['currentRevision'],'from':_0x4608dd,'to':_0x4608dd});_0x482f00['authors']=[],_0x482f00['authorsIds']=[],_0x482f00['id']=this['currentRevision']['id'],this['currentRevision']['_update'](_0x482f00,!0x0),delete _0x482f00['authors'],_0x2a5ef9['push'](_0x482f00);}const _0x44b6c9=this['editor']['plugins']['get']('Users')['me'],_0x1efdd8=this['_getFromVersion'](_0x4608dd),_0x46366b=this['buildRevisionData']({'from':_0x1efdd8,'to':_0x4608dd});_0x3b1b1a['creatorId']=_0x44b6c9['id'],_0x3b1b1a['name']=_0x3b1b1a['name']||null,_0x3b1b1a['id']=_0x3b1b1a['id']||_0xa10f41(),_0x3b1b1a={..._0x3b1b1a,..._0x46366b};const _0x18eed2=this['addRevisionData'](_0x3b1b1a);_0x2a5ef9['push'](_0x3b1b1a);const _0x4edd8d=this['repository']['getIndex'](_0x18eed2);if(0x0!==_0x4edd8d){const _0x5d2803=this['repository']['getRevision'](_0x4edd8d-0x1);if(_0x5d2803['fromVersion']!==_0x4608dd){const _0xce0257=this['_revisionDataBuilder']['getData'](_0x4608dd,_0x5d2803['toVersion']),_0x1c2fb9={'id':_0x5d2803['id'],'diffData':_0xce0257['diffData'],'authorsIds':_0xce0257['authorsIds'],'authors':_0xce0257['authorsIds']['map'](_0x406c5c=>this['editor']['plugins']['get']('Users')['getUser'](_0x406c5c)),'fromVersion':_0x4608dd};_0x5d2803===this['currentRevision']&&(_0x1c2fb9['createdAt']=new Date(_0x3b1b1a['createdAt']['getTime']()+0xa)),_0x5d2803['_update'](_0x1c2fb9,!0x0),delete _0x1c2fb9['authors'],_0x2a5ef9['push'](_0x1c2fb9);}}if(this['adapter']){for(const _0x105bd6 of _0x2a5ef9)this['_bufferUpdate'](_0x105bd6['id'],_0x105bd6,!0x0);this['sendBufferedUpdates']();}return _0x18eed2;}['addRevisionData'](_0x5ebda8){const _0x3b3135=this['repository']['createRevision'](_0x5ebda8);return this['adapter']&&_0x3b3135['on']('_update',(_0x4287fa,_0x5b351a,_0x2f58ed)=>{_0x2f58ed||(this['_bufferUpdate'](_0x5b351a['id'],_0x5b351a,!0x0),this['sendBufferedUpdates']());}),this['repository']['addRevision'](_0x3b3135,this['_findInsertionIndex'](_0x3b3135)),_0x3b3135;}async['getRevisionDocumentData'](_0x4df08b){await this['_loadRevisionData'](_0x4df08b);const _0x524222={};for(const _0x1132c3 in _0x4df08b['diffData']){const _0x304a8d=this['_removeRevisionMarkers'](JSON['parse'](_0x4df08b['diffData'][_0x1132c3]['insertions'])),_0x344280=this['editor']['editing']['view']['document'],_0x5be6ac=new _0x14fd22(_0x344280,_0x304a8d['map'](_0x544072=>this['_getViewObj'](_0x544072)));_0x524222[_0x1132c3]=this['editor']['data']['processor']['toData'](_0x5be6ac);}return _0x524222;}['sendBufferedUpdates'](){if(0x0===this['_bufferedUpdates']['size'])return;if(this['_isPendingUpdate'])return;let _0x459f62=Array['from'](this['_bufferedUpdates']['values']());this['_bufferedUpdates']['clear']();for(let _0x423f40=0x0;_0x423f40<_0x459f62['length'];_0x423f40++){const _0x149563=_0x459f62[_0x423f40];let _0x517c2e=!0x1;for(const _0x5c0098 of Object['keys'](_0x149563))void 0x0===_0x149563[_0x5c0098]?delete _0x149563[_0x5c0098]:'id'!==_0x5c0098&&(_0x517c2e=!0x0);_0x517c2e||(_0x459f62[_0x423f40]=null);}if(_0x459f62=_0x459f62['filter'](_0x262876=>null!==_0x262876),!_0x459f62['length'])return;for(let _0xbf095c=0x0;_0xbf095c<_0x459f62['length'];_0xbf095c++){const _0x3a6ce7=_0x459f62[_0xbf095c];void 0x0!==_0x3a6ce7['fromVersion']&&void 0x0===_0x3a6ce7['toVersion']&&(_0x3a6ce7['toVersion']=this['repository']['getRevision'](_0x3a6ce7['id'])['toVersion']),void 0x0!==_0x3a6ce7['toVersion']&&void 0x0===_0x3a6ce7['fromVersion']&&(_0x3a6ce7['fromVersion']=this['repository']['getRevision'](_0x3a6ce7['id'])['fromVersion']);}const _0x4c1d2d=this['editor']['config']['get']('collaboration.channelId');this['_isPendingUpdate']=!0x0,this['_addPendingAction'](),this['adapter']['updateRevisions'](_0x459f62,_0x4c1d2d)['finally'](()=>{this['_isPendingUpdate']=!0x1;})['then'](()=>{this['_removePendingAction'](),this['sendBufferedUpdates']();});}['_addPendingAction'](){const t=this['editor']['t'];if(!this['_pendingAction']){const _0xa5d913=this['editor']['plugins']['get']('PendingActions');this['_pendingAction']=_0xa5d913['add'](t({'string':'Unsaved\x20change\x20in\x20revision\x20history.','id':'PENDING_ACTION_REVISION_HISTORY'}));}}['_removePendingAction'](){this['_pendingAction']&&(this['editor']['plugins']['get']('PendingActions')['remove'](this['_pendingAction']),this['_pendingAction']=null);}['_findInsertionIndex'](_0x70e605){const _0x3b481a=this['repository']['getRevisions']();_0x3b481a['reverse']();let _0x216441=0x0;for(;_0x216441<_0x3b481a['length'];){const _0x3a929f=_0x3b481a[_0x216441];if(_0x3a929f['id']===this['_initialRevisionId'])break;const _0x8f5ddd=_0x70e605['toVersion']-_0x3a929f['toVersion']||_0x70e605['fromVersion']-_0x3a929f['fromVersion'];if(_0x8f5ddd>0x0)break;if(_0x8f5ddd<0x0)_0x216441++;else{if(!_0x70e605['creator']&&_0x3a929f['creator'])break;if(_0x3a929f['creator']||!_0x70e605['creator']){if(_0x70e605['createdAt']>_0x3a929f['createdAt'])break;_0x216441++;}else _0x216441++;}}return _0x216441;}['setRevisionData'](_0x5e016e){const _0x14bfad=this['repository']['getRevision'](_0x5e016e['id']);if(_0x5e016e['createdAt']&&(_0x5e016e['createdAt']=new Date(_0x5e016e['createdAt'])),_0x5e016e['authorsIds']){const _0x5c2b58=this['editor']['plugins']['get']('Users');_0x5e016e['authors']=_0x5e016e['authorsIds']['map'](_0x4cb5c2=>_0x5c2b58['getUser'](_0x4cb5c2));}_0x14bfad['_update'](_0x5e016e,!0x0);}['buildRevisionData']({revision:_0x52c5aa=null,from:_0x4d3041=null,to:_0x93bb1f=null}){_0x4d3041=null!==_0x4d3041?_0x4d3041:_0x52c5aa['fromVersion'],_0x93bb1f=null!==_0x93bb1f?_0x93bb1f:_0x52c5aa['toVersion'];const _0x212dde=this['_revisionDataBuilder']['getData'](_0x4d3041,_0x93bb1f),_0x15649a={'diffData':_0x212dde['diffData'],'authorsIds':_0x212dde['authorsIds'],'fromVersion':_0x4d3041,'toVersion':_0x93bb1f};return _0x52c5aa&&_0x93bb1f===_0x52c5aa['toVersion']||(_0x15649a['createdAt']=new Date()),_0x15649a;}['_loadRevisionData'](_0x4d278b){if(!_0x4d278b||_0x4d278b['diffData'])return Promise['resolve']();{const _0x5d5701=this['editor']['config']['get']('collaboration.channelId');return this['adapter']['getRevision']({'channelId':_0x5d5701,'revisionId':_0x4d278b['id']})['then'](_0x36bf64=>{_0x4d278b['diffData']=_0x36bf64['diffData'];});}}['_bufferUpdate'](_0xb17b5b,_0x478fd0,_0x43278e){if(this['_bufferedUpdates']['has'](_0xb17b5b)){const _0x3032af=this['_bufferedUpdates']['get'](_0xb17b5b);_0x478fd0=_0x43278e?{..._0x3032af,..._0x478fd0}:{..._0x478fd0,..._0x3032af};}this['_bufferedUpdates']['set'](_0xb17b5b,_0x478fd0);}['_getFromVersion'](_0x23f1b0){const _0x145268=this['repository']['getRevisions']();_0x145268['reverse'](),_0x145268['shift']();const _0x5eb1b3=_0x145268['find'](_0x2827fc=>_0x2827fc['toVersion']<=_0x23f1b0)['toVersion'];return _0x5eb1b3<this['_startingVersion']?this['_startingVersion']:_0x5eb1b3;}['_createInitialRevision'](_0x7f657c){const _0x3b9498=this['repository']['getRevision'](this['repository']['length']-0x1);if(_0x3b9498)this['_initialRevisionId']=_0x3b9498['id'];else{const t=this['editor']['t'],_0x3f3c7f=!this['editor']['model']['document']['roots']['find'](_0x348475=>this['editor']['model']['hasContent'](_0x348475)),_0x1bac03=this['editor']['plugins']['get']('Users')['me']['id'],_0xb2ae2f=t(_0x3f3c7f?'Empty\x20document':'Initial\x20revision');this['_makeRevision']({'from':_0x7f657c,'to':_0x7f657c,'id':this['_initialRevisionId'],'name':_0xb2ae2f,'creatorId':_0x1bac03});}}['_createCurrentRevision'](_0xafc0aa){const _0x138ead=this['_source']['getCurrentRevisionId']();this['currentRevision']=this['repository']['getRevision'](_0x138ead),this['currentRevision']||(this['currentRevision']=this['_makeRevision']({'from':_0xafc0aa,'to':_0xafc0aa,'id':_0x138ead}));}['_makeRevision']({name:_0x1a3dd1,from:_0x4d0bc0,to:_0x1df2d6,creatorId:_0x1ebb57,id:_0x95fb29}){const _0x1f019e=this['buildRevisionData']({'from':_0x4d0bc0,'to':_0x1df2d6});_0x1a3dd1&&(_0x1f019e['name']=_0x1a3dd1),_0x1ebb57&&(_0x1f019e['creatorId']=_0x1ebb57),_0x1f019e['id']=_0x95fb29;const _0x23effa=this['addRevisionData'](_0x1f019e);return this['adapter']&&this['_bufferUpdate'](_0x1f019e['id'],_0x1f019e,!0x0),_0x23effa;}['_setConversion'](){this['editor']['conversion']['for']('dataDowncast')['markerToData']({'model':'revision'});}['_removeRevisionMarkers'](_0x58fd8e){return(_0x58fd8e=_0x58fd8e['filter'](_0x250892=>!_0x250892['name']||'revision-start'!==_0x250892['name']&&'revision-end'!==_0x250892['name']))['forEach'](_0x295656=>{'string'!=typeof _0x295656&&(_0x295656['children']=this['_removeRevisionMarkers'](_0x295656['children']),_0x295656['attributes']=_0x295656['attributes']['filter'](_0x1ae584=>!_0x1ae584[0x0]['startsWith']('data-revision-')));}),_0x58fd8e;}['_getViewObj'](_0xc90fd0){const _0x208d31=this['editor']['editing']['view']['document'];if('string'==typeof _0xc90fd0)return new _0x19527d(_0x208d31,_0xc90fd0);{const _0x426b2a=_0xc90fd0['children']['map'](_0x4408dc=>this['_getViewObj'](_0x4408dc));return new _0x3c439f(_0x208d31,_0xc90fd0['name'],_0xc90fd0['attributes'],_0x426b2a);}}}class V{constructor(_0x34149c){this['editor']=_0x34149c,this['_savedMetaData']=new Map(),this['_lastFrom']=-0x1,this['_lastTo']=-0x1,this['_markers']=new Map(),this['_diffRoots']=new Map(),this['_baseRoots']=new Map(),this['_touched']=new Map(),this['_touchedMarkers']=new Map(),this['_revisionId']=0x0,this['_rootNames']=this['editor']['model']['document']['getRootNames'](),this['_rootNames']['push']('$graveyard');}['init'](_0xc0273d){this['source']=_0xc0273d;const _0x3cd643=new Map();for(const _0x424bb0 of this['_rootNames']){const _0x21d3bf=P(this['editor']['model']['document']['getRoot'](_0x424bb0));for(const _0xe22d43 of this['editor']['model']['createRangeIn'](_0x21d3bf)['getWalker']({'singleCharacters':!0x0})){const _0x1b4a41=this['_getVidAttributeName'](_0xe22d43),_0x5793e3=_0xe22d43['item'],_0x58bc56=this['_revisionId']++;_0x3eeba6(this['editor']['model']['createRangeOn'](_0x5793e3),_0x1b4a41,_0x58bc56);}_0x3cd643['set'](_0x424bb0,_0x21d3bf);}const _0xf810c7=Array['from'](this['editor']['model']['markers'])['map'](_0x3625ad=>[_0x3625ad['name'],_0x3625ad['getRange']()]),_0xbc579c=this['source']['_operations'][this['source']['_operations']['length']-0x1]['baseVersion']+0x1;this['_saveMetaData'](_0xbc579c,_0x3cd643,_0xf810c7),this['_startingRevisionId']=this['_revisionId'];}['getData'](_0x4a7714,_0x432d46){if(this['_lastFrom']===_0x4a7714&&this['_lastTo']<=_0x432d46)this['_savedMetaData']['size']>0x1&&this['_removeMetaData'](this['_lastTo']),this['_applyOperations'](this['_lastTo'],_0x432d46);else{if(!this['_savedMetaData']['has'](_0x4a7714)){const _0x26e537=this['_getPreviousFrom'](_0x4a7714);this['_calculateMetaData'](_0x26e537,_0x4a7714);}this['_calculateMetaData'](_0x4a7714,_0x432d46);}return this['_lastFrom']=_0x4a7714,this['_lastTo']=_0x432d46,this['_getState']();}['_saveEmptyMetaData'](_0xbde0be){const _0x51f52c=new Map();for(const _0xf91307 of this['_rootNames']){const _0x2e90bb=new _0x305e8f();_0x2e90bb['rootName']=_0xf91307,_0x51f52c['set'](_0xf91307,_0x2e90bb);}this['_saveMetaData'](_0xbde0be,_0x51f52c,[]);}['_saveMetaData'](_0x55855a,_0x499a1a,_0x3dfcee){const _0x528db2=new Map(_0x499a1a),_0x3d8ddd=new Map();for(const [_0x3cd736,_0x45d55d]of _0x3dfcee)_0x3d8ddd['set'](_0x3cd736,{'start':_0x45d55d['start']['clone'](),'end':_0x45d55d['end']['clone'](),'rootName':_0x45d55d['root']['rootName']});this['_savedMetaData']['set'](_0x55855a,{'roots':_0x528db2,'markers':_0x3d8ddd});}['_removeMetaData'](_0x2621bc){this['_savedMetaData']['delete'](_0x2621bc);}['reInit'](){this['_reset'](),this['_lastFrom']=-0x1,this['_lastTo']=-0x1,this['_savedMetaData']['clear'](),this['init'](this['source']);}['_reset'](){this['_touched']['clear'](),this['_touchedMarkers']['clear'](),this['_diffRoots']['clear'](),this['_baseRoots']['clear'](),this['_markers']['clear'](),this['_startingRevisionId']=this['_revisionId'];}['_calculateMetaData'](_0x2c1637,_0x4a40e4){this['_reset']();const {roots:_0x83a15a,markers:_0x39ce4b}=this['_savedMetaData']['get'](_0x2c1637);this['_baseRoots']=new Map(_0x83a15a),this['_fixGraveyardVids'](this['_baseRoots']['get']('$graveyard'));for(const [_0x165b72,_0x5d102c]of this['_baseRoots'])this['_diffRoots']['set'](_0x165b72,P(_0x5d102c));for(const [_0x118d1b,_0xf49236]of _0x39ce4b){const _0x3ad4bb=this['_baseRoots']['get'](_0xf49236['rootName']),_0x1b9f5a=this['_diffRoots']['get'](_0xf49236['rootName']),_0xbe8851=new _0x2a55e5(this['_fixPosition'](_0xf49236['start'],_0x3ad4bb),this['_fixPosition'](_0xf49236['end'],_0x3ad4bb)),_0x2859b5=this['_fixRange'](_0xbe8851,_0x1b9f5a);_0x3ad4bb['markers']['set'](_0x118d1b,_0xbe8851),this['_markers']['set'](_0x118d1b,_0x2859b5);}this['_applyOperations'](_0x2c1637,_0x4a40e4);}['_applyOperations'](_0x5d6d92,_0x42bf13){for(const _0x315b74 of this['source']['getOperations'](_0x5d6d92,_0x42bf13))this['_handleOperation'](_0x315b74);for(const _0x2ed557 of this['_diffRoots']['values']())_0x2ed557['markers']['clear']();for(const [_0x2e8f76,_0x561ada]of this['_markers']){this['_diffRoots']['get'](_0x561ada['root']['rootName'])['markers']['set'](_0x2e8f76,_0x561ada['clone']());}this['_saveMetaData'](_0x42bf13,Array['from'](this['_diffRoots'])['map'](([_0x366eea,_0x635511])=>[_0x366eea,P(_0x635511)]),this['_markers']);}['_getPreviousFrom'](_0x2e2678){const _0x2c3dae=Array['from'](this['_savedMetaData']['keys']());_0x2c3dae['sort']((_0x56f221,_0x23aafc)=>_0x56f221-_0x23aafc),_0x2c3dae['reverse']();for(const _0x2c10e6 of _0x2c3dae)if(_0x2c10e6<_0x2e2678)return _0x2c10e6;const _0x369892=this['source']['_operations'][0x0]['baseVersion'];return this['_saveEmptyMetaData'](_0x369892),_0x369892;}['_fixGraveyardVids'](_0x447a66){for(const _0x2d86c9 of _0x447a66['getChildren']())_0x2d86c9['is']('text')?_0x2d86c9['_setAttribute']('vid',this['_revisionId']++):(_0x2d86c9['_setAttribute']('vid_start',this['_revisionId']++),this['_fixGraveyardVids'](_0x2d86c9),_0x2d86c9['_setAttribute']('vid_end',this['_revisionId']++));}['_copyMarkers'](_0x455420,_0x2dfa00){const _0x4e2f46=Array['from'](_0x2dfa00['markers'])['map'](([_0x467ef0,_0x3f5bee])=>[_0x467ef0,this['_fixRange'](_0x3f5bee,_0x455420)]);_0x455420['markers']=new Map(_0x4e2f46);}['_transformMarkers'](_0x320131){for(const _0x57924e of this['_markers']['values']()){const _0x1dddea=_0x57924e['getTransformedByOperation'](_0x320131),_0x3edaa1=_0x2a55e5['_createFromRanges'](_0x1dddea);_0x57924e['start']=_0x3edaa1['start'],_0x57924e['end']=_0x3edaa1['end'];}}['_handleOperation'](_0x2b6eeb){const _0x1163d5=_0x2b6eeb['clone']();switch(_0x1163d5['_authorId']=_0x2b6eeb['_authorId'],this['_fixOperation'](_0x1163d5,this['_diffRoots']),_0x1163d5['type']){case'insert':this['_handleInsertOperation'](_0x1163d5);break;case'move':case'remove':case'reinsert':this['_handleMoveOperation'](_0x1163d5);break;case'merge':this['_handleMergeOperation'](_0x1163d5);break;case'split':this['_handleSplitOperation'](_0x1163d5);break;case'addAttribute':case'changeAttribute':case'removeAttribute':case'rename':_0x1163d5['_execute']();break;case'marker':this['_handleMarkerOperation'](_0x1163d5);}this['_transformMarkers'](_0x1163d5);}['_getBaseVids'](_0x1f7884){return _0x1f7884['map'](_0xf6b5f6=>{const _0x317f44=this['_getVidAttributeName'](_0xf6b5f6);return Number(_0xf6b5f6['item']['getAttribute'](_0x317f44));});}['_generateTape'](_0x5cfc3f,_0x4372f8){if(_0x5cfc3f['is']('text'))_0x4372f8['push']({'item':_0x5cfc3f,'type':'text'});else{_0x5cfc3f['is']('element')&&_0x4372f8['push']({'item':_0x5cfc3f,'type':'elementStart'});for(const _0x39cae3 of _0x5cfc3f['getChildren']())this['_generateTape'](_0x39cae3,_0x4372f8);_0x5cfc3f['is']('element')&&_0x4372f8['push']({'item':_0x5cfc3f,'type':'elementEnd'});}return _0x4372f8;}['_getState'](){const _0x50dfd3=this['editor']['model']['document']['getRootNames'](),_0x35ee60=new Map(this['_touched']),_0x51a7f6=new Map(_0x35ee60),_0x734d27=new Map(),_0x3a2f5a={'insertions':{},'deletions':{}},_0x1d22cb={'insertions':{},'deletions':{}},_0xb1f451=new Map();for(const _0x3b0ce4 of _0x50dfd3){const _0x1bde8e=this['_diffRoots']['get'](_0x3b0ce4),_0x4510ab=this['_baseRoots']['get'](_0x3b0ce4);_0x3a2f5a['insertions'][_0x3b0ce4]=P(_0x1bde8e),_0x3a2f5a['deletions'][_0x3b0ce4]=P(_0x4510ab),this['_copyMarkers'](_0x3a2f5a['deletions'][_0x3b0ce4],_0x4510ab),this['_copyMarkers'](_0x3a2f5a['insertions'][_0x3b0ce4],_0x1bde8e),_0x1d22cb['insertions'][_0x3b0ce4]=this['_generateTape'](_0x3a2f5a['insertions'][_0x3b0ce4],[]),_0x1d22cb['deletions'][_0x3b0ce4]=this['_generateTape'](_0x3a2f5a['deletions'][_0x3b0ce4],[]);}for(const _0x503ea8 of _0x50dfd3){const _0x25ab26=_0x1d22cb['insertions'][_0x503ea8];for(const _0x1f4e1e of _0x25ab26){const _0x2e49e3=this['_getVidAttributeName'](_0x1f4e1e),_0x40a8b3=_0x1f4e1e['item']['getAttribute'](_0x2e49e3);_0x51a7f6['delete'](_0x40a8b3),_0x40a8b3>=this['_startingRevisionId']&&!_0x734d27['has'](_0x40a8b3)&&_0x734d27['set'](_0x40a8b3,_0x35ee60['get'](_0x40a8b3));}}for(const _0x4f17d3 of _0x50dfd3){const _0x2f84d6=_0x1d22cb['insertions'][_0x4f17d3],_0x5ced49=this['_getBaseVids'](_0x1d22cb['deletions'][_0x4f17d3]);let _0x54e307=0x0;for(const _0x3f73fe of _0x2f84d6){const _0x3306ab=this['_getVidAttributeName'](_0x3f73fe),_0x129191=_0x3f73fe['item']['getAttribute'](_0x3306ab);if(!_0x734d27['has'](_0x129191)&&!_0xb1f451['has'](_0x129191)){if(_0x51a7f6['has'](_0x129191))_0x54e307++;else{if(_0x129191!=_0x5ced49[_0x54e307]){const _0x2f3264=_0x35ee60['get'](_0x129191)||_0x35ee60['get'](_0x5ced49[_0x54e307]);for(;_0x129191!=_0x5ced49[_0x54e307];)_0x51a7f6['has'](_0x5ced49[_0x54e307])||(_0xb1f451['set'](_0x5ced49[_0x54e307],_0x2f3264),_0x35ee60['set'](_0x5ced49[_0x54e307],_0x2f3264)),_0x54e307++;}_0x54e307++;}}}}for(const _0x513e2a of _0x50dfd3){const _0x545340=_0x1d22cb['insertions'][_0x513e2a];for(const _0x391705 of _0x545340){const _0x7b24cd=this['_getVidAttributeName'](_0x391705),_0x1cf8b8=_0x391705['item']['getAttribute'](_0x7b24cd);if(_0xb1f451['has'](_0x1cf8b8)){const _0x221651=_0xb1f451['get'](_0x1cf8b8);_0x51a7f6['has'](_0x1cf8b8)||_0x51a7f6['set'](_0x1cf8b8,{..._0x221651});const _0x436480=this['_revisionId']++;_0x3eeba6(this['editor']['model']['createRangeOn'](_0x391705['item']),_0x7b24cd,_0x436480),_0x734d27['set'](_0x436480,{..._0x221651}),_0x35ee60['set'](_0x436480,{..._0x221651});}}}for(const _0x3e73d8 of _0x51a7f6['keys']())_0x3e73d8>=this['_startingRevisionId']&&_0x51a7f6['delete'](_0x3e73d8);const _0x4d8e8a=new Map();for(const _0x5683d4 of _0x50dfd3){let _0x4358fb=_0x1d22cb['insertions'][_0x5683d4];for(const _0x35f2eb of _0x4358fb)if(_0x35f2eb['item']['is']('element','tableCell')){const _0xafc89=this['_getVidAttributeName'](_0x35f2eb),_0x454cee=_0x35f2eb['item']['getAttribute'](_0xafc89);if(_0x734d27['has'](_0x454cee)){const _0x29f7b5=_0x35f2eb['item']['parent']['parent']['getAttribute']('vid_start'),_0x9d1286=_0x4d8e8a['get'](_0x29f7b5)||new Set();_0x9d1286['add'](_0x734d27['get'](_0x454cee)['userId']),_0x4d8e8a['set'](_0x29f7b5,_0x9d1286);}}_0x4358fb=_0x1d22cb['deletions'][_0x5683d4];for(const _0x4e888e of _0x4358fb)if(_0x4e888e['item']['is']('element','tableCell')){const _0x1f655b=this['_getVidAttributeName'](_0x4e888e),_0x69322f=_0x4e888e['item']['getAttribute'](_0x1f655b);if(_0x51a7f6['has'](_0x69322f)){const _0x168f9e=_0x4e888e['item']['parent']['parent']['getAttribute']('vid_start'),_0x2c5f2e=_0x4d8e8a['get'](_0x168f9e)||new Set();_0x2c5f2e['add'](_0x51a7f6['get'](_0x69322f)['userId']),_0x4d8e8a['set'](_0x168f9e,_0x2c5f2e);}}for(const _0x35138b of _0x4d8e8a['keys']())(_0x734d27['has'](_0x35138b)||_0x51a7f6['has'](_0x35138b))&&_0x4d8e8a['delete'](_0x35138b);}for(const _0x4a364e of _0x50dfd3){const _0x1d9c4a=_0x1d22cb['insertions'][_0x4a364e];let _0x124e10=null,_0x312018=null;for(const _0x37c376 of _0x1d9c4a){const _0x42f079=this['_getVidAttributeName'](_0x37c376),_0x5bb8c5=_0x37c376['item']['getAttribute'](_0x42f079),_0x25c5ae=_0x4d8e8a['get'](_0x5bb8c5);if(_0x25c5ae&&'elementStart'==_0x37c376['type']&&(_0x124e10=Array['from'](_0x25c5ae)[0x0],_0x312018=_0x37c376['item']['getAttribute']('vid_end')),_0x124e10){const _0x590eb6=this['_getVidAttributeName'](_0x37c376),_0x5e4c5f=_0x37c376['item']['getAttribute'](_0x590eb6),_0x3a94f6=this['_revisionId']++;_0x51a7f6['set'](_0x5e4c5f,{'userId':_0x124e10}),_0x734d27['set'](_0x3a94f6,{'userId':_0x124e10}),_0x3eeba6(this['editor']['model']['createRangeOn'](_0x37c376['item']),_0x590eb6,_0x3a94f6);}_0x5bb8c5==_0x312018&&(_0x124e10=null,_0x312018=null);}}const _0x2dc70c={},_0x1e16b4=new Set();for(const _0x328602 of _0x50dfd3){const _0x28797f=_0x3a2f5a['deletions'][_0x328602],_0x5ef775=_0x3a2f5a['insertions'][_0x328602];for(const {userId:_0x6d5cdc}of this['_touchedMarkers']['values']())null!==_0x6d5cdc&&_0x1e16b4['add'](_0x6d5cdc);this['_markChanges'](_0x5ef775,_0x1d22cb['insertions'][_0x328602],_0x734d27,'insertion',_0x1e16b4),this['_markChanges'](_0x28797f,_0x1d22cb['deletions'][_0x328602],_0x51a7f6,'deletion',_0x1e16b4),this['_removeVids'](_0x5ef775),this['_removeVids'](_0x28797f),_0x2dc70c[_0x328602]={'insertions':this['_prepareViewToSave'](_0x5ef775),'deletions':this['_prepareViewToSave'](_0x28797f)};}return{'diffData':_0x2dc70c,'authorsIds':Array['from'](_0x1e16b4)};}['_processRootBeforeSave'](_0x56c555){for(const [_0x177282,_0x13b38f]of _0x56c555['markers']){if(!_0x177282['startsWith']('revision:'))continue;const _0x3add74=_0x13b38f['start']['getAncestors']()['filter'](_0x5b2bde=>'tableCell'==_0x5b2bde['name']);for(const _0x1b8c46 of _0x3add74)0x1==_0x1b8c46['childCount']&&_0x1b8c46['getChild'](0x0)['is']('element','paragraph')&&_0x1b8c46['getChild'](0x0)['_setAttribute']('keepParagraph',!0x0);}}['_prepareViewToSave'](_0x2ddb64){this['_processRootBeforeSave'](_0x2ddb64);const _0x105210=this['editor']['data']['toView'](_0x2ddb64,{}),_0x15fe20=Array['from'](_0x105210['getChildren']())['map'](_0x113579=>this['_getViewObj'](_0x113579));return JSON['stringify'](_0x15fe20);}['_getViewObj'](_0x3d96e0){return _0x3d96e0['is']('text')?_0x3d96e0['data']:{'name':_0x3d96e0['name'],'attributes':Array['from'](_0x3d96e0['getAttributes']()),'children':Array['from'](_0x3d96e0['getChildren']())['map'](_0x410f39=>this['_getViewObj'](_0x410f39))};}['_removeVids'](_0x19a8ad){const _0x10b3a4=_0x19a8ad['_removeChildren'](0x0,_0x19a8ad['childCount']);for(const _0x4b56a8 of _0x10b3a4)_0x4b56a8['is']('text')?_0x4b56a8['_removeAttribute']('vid'):(_0x4b56a8['_removeAttribute']('vid_start'),_0x4b56a8['_removeAttribute']('vid_end'),this['_removeVids'](_0x4b56a8));_0xe4f163(this['editor']['model']['createPositionAt'](_0x19a8ad,0x0),_0x10b3a4);}['_markChanges'](_0x3c4263,_0xac1635,_0x2de55a,_0x3ee450,_0x5d4d71){let _0x29ca83=null,_0x4b8129=null,_0xa7e213=0x0;const _0xff82da=this['editor']['model'];for(let _0x2c69a2=0x0;_0x2c69a2<_0xac1635['length'];_0x2c69a2++){const _0x5ad191=this['_getVidAttributeName'](_0xac1635[_0x2c69a2]),_0x50c4b9=_0xac1635[_0x2c69a2]['item']['getAttribute'](_0x5ad191),_0x2abe90=_0x2de55a['get'](_0x50c4b9),_0x1e899c=_0x2c69a2==_0xac1635['length']-0x1;(!_0x29ca83&&_0x2abe90&&(_0x29ca83=_0x2abe90,_0x4b8129=_0xac1635[_0x2c69a2]),_0x29ca83&&(!_0x2abe90||_0x2abe90['userId']!=_0x29ca83['userId']))&&(_0x127743(_0x2abe90,N(_0x4b8129,_0xff82da),N(_0xac1635[_0x2c69a2],_0xff82da)),_0x29ca83=_0x2abe90||null,_0x4b8129=_0x2abe90?_0xac1635[_0x2c69a2]:null),_0x29ca83&&_0x1e899c&&_0x127743(_0x2abe90,N(_0x4b8129,_0xff82da),E(_0xac1635[_0x2c69a2],_0xff82da));}function _0x127743(_0x512e46,_0xb3e9a3,_0x540e32){const _0x1c67b2=_0x29ca83['userId'],_0x527540='revision:'+_0x3ee450+':'+_0x1c67b2+':'+_0xa7e213++,_0x27fc8d=_0xff82da['createRange'](_0xb3e9a3,_0x540e32);_0x3c4263['markers']['set'](_0x527540,_0x27fc8d),null!==_0x1c67b2&&_0x5d4d71['add'](_0x1c67b2);}}['_getVidAttributeName'](_0x168a16){switch(_0x168a16['type']){case'elementStart':return'vid_start';case'elementEnd':return'vid_end';default:return'vid';}}['_fixOperation'](_0x5e55d5,_0x30d541){_0x5e55d5['baseVersion']=null;for(const _0x46ca26 in _0x5e55d5){if(_0x5e55d5[_0x46ca26]instanceof _0x33daea){const _0xb281a7=_0x30d541['get'](_0x5e55d5[_0x46ca26]['root']['rootName']);_0x5e55d5[_0x46ca26]=this['_fixPosition'](_0x5e55d5[_0x46ca26],_0xb281a7);}if(_0x5e55d5[_0x46ca26]instanceof _0x2a55e5){const _0x2c7359=_0x30d541['get'](_0x5e55d5[_0x46ca26]['root']['rootName']);_0x5e55d5[_0x46ca26]=this['_fixRange'](_0x5e55d5[_0x46ca26],_0x2c7359);}}_0x5e55d5['root']&&(_0x5e55d5['root']=_0x30d541['get'](_0x5e55d5['root']['rootName']));}['_fixRange'](_0x4c3748,_0x337c30){return this['editor']['model']['createRange'](this['_fixPosition'](_0x4c3748['start'],_0x337c30),this['_fixPosition'](_0x4c3748['end'],_0x337c30));}['_fixPosition'](_0x5c13eb,_0x30ced4){return this['editor']['model']['createPositionFromPath'](_0x30ced4,_0x5c13eb['path'],_0x5c13eb['stickiness']);}['_handleInsertOperation'](_0x381b27){_0x381b27['_execute']();const _0x18f833=null===_0x381b27['_authorId']?null:_0x381b27['_authorId']||this['editor']['plugins']['get']('Users')['me']['id'],_0x51e5c7=this['editor']['model']['createRange'](_0x381b27['position'],_0x381b27['position']['getShiftedBy'](_0x381b27['howMany']));for(const _0x5f0ca9 of _0x51e5c7['getWalker']({'singleCharacters':!0x0})){const _0x5a3b93=this['_getVidAttributeName'](_0x5f0ca9),_0x2475ca=this['_revisionId']++;_0x3eeba6(this['editor']['model']['createRangeOn'](_0x5f0ca9['item']),_0x5a3b93,_0x2475ca),this['_touched']['set'](_0x2475ca,{'userId':_0x18f833});}}['_handleMoveOperation'](_0x213aca){_0x213aca['_execute']();const _0x266a99=null===_0x213aca['_authorId']?null:_0x213aca['_authorId']||this['editor']['plugins']['get']('Users')['me']['id'],_0x218da5=_0x213aca['getMovedRangeStart'](),_0x17f37b=this['editor']['model']['createRange'](_0x218da5,_0x218da5['getShiftedBy'](_0x213aca['howMany']));for(const _0x271919 of _0x17f37b['getWalker']({'singleCharacters':!0x0})){const _0x56bcf1=this['_getVidAttributeName'](_0x271919),_0x239e42=_0x271919['item']['getAttribute'](_0x56bcf1);this['_touched']['set'](_0x239e42,{'userId':_0x266a99});}}['_handleMergeOperation'](_0x2cb9a0){const _0x3ac90e=null===_0x2cb9a0['_authorId']?null:_0x2cb9a0['_authorId']||this['editor']['plugins']['get']('Users')['me']['id'],_0x1c19bb=_0x2cb9a0['targetPosition']['parent'],_0x30f996=_0x2cb9a0['sourcePosition']['parent'],_0x603015=_0x1c19bb['getAttribute']('vid_end'),_0x241b65=_0x30f996['getAttribute']('vid_start');_0x3eeba6(this['editor']['model']['createRangeOn'](_0x1c19bb),'vid_end',_0x30f996['getAttribute']('vid_end')),_0x3eeba6(this['editor']['model']['createRangeOn'](_0x30f996),'vid_end',_0x603015),this['_touched']['set'](_0x241b65,{'userId':_0x3ac90e}),this['_touched']['set'](_0x603015,{'userId':_0x3ac90e}),_0x2cb9a0['_execute']();}['_handleSplitOperation'](_0x313836){const _0xfb84b2=null===_0x313836['_authorId']?null:_0x313836['_authorId']||this['editor']['plugins']['get']('Users')['me']['id'],_0x51a050=_0x313836['graveyardPosition'],_0x2c8180=_0x313836['splitPosition']['parent'];_0x313836['_execute']();const _0x463320=_0x2c8180['getAttribute']('vid_end'),_0x4a1c3f=_0x313836['insertionPosition']['nodeAfter'];if(_0x51a050){const _0x170235=_0x4a1c3f['getAttribute']('vid_end'),_0xc9759f=_0x2c8180['getAttribute']('vid_end');_0x3eeba6(this['editor']['model']['createRangeOn'](_0x2c8180),'vid_end',_0x170235),_0x3eeba6(this['editor']['model']['createRangeOn'](_0x4a1c3f),'vid_end',_0xc9759f),this['_touched']['set'](_0x2c8180['getAttribute']('vid_end'),{'userId':_0xfb84b2}),this['_touched']['set'](_0x4a1c3f['getAttribute']('vid_start'),{'userId':_0xfb84b2});}else{const _0x2fa8e4=this['_revisionId']++,_0x2cc2bd=this['_revisionId']++;_0x3eeba6(this['editor']['model']['createRangeOn'](_0x2c8180),'vid_end',_0x2fa8e4),_0x3eeba6(this['editor']['model']['createRangeOn'](_0x4a1c3f),'vid_start',_0x2cc2bd),_0x3eeba6(this['editor']['model']['createRangeOn'](_0x4a1c3f),'vid_end',_0x463320),this['_touched']['set'](_0x2fa8e4,{'userId':_0xfb84b2}),this['_touched']['set'](_0x2cc2bd,{'userId':_0xfb84b2});}}['_handleMarkerOperation'](_0x593e6f){if(!_0x593e6f['affectsData'])return;const _0x4de2e5=_0x593e6f['oldRange']?_0x593e6f['oldRange']['root']:null,_0x5690c8=_0x593e6f['newRange']?_0x593e6f['newRange']['root']:null;_0x4de2e5&&this['_markers']['delete'](_0x593e6f['name']),_0x5690c8&&this['_markers']['set'](_0x593e6f['name'],_0x593e6f['newRange']['clone']());const _0x19d636=null===_0x593e6f['_authorId']?null:_0x593e6f['_authorId']||this['editor']['plugins']['get']('Users')['me']['id'],_0x39ee61=_0x593e6f['name'];if(!this['_touchedMarkers']['has'](_0x39ee61))return void this['_touchedMarkers']['set'](_0x39ee61,{'range':_0x593e6f['oldRange'],'userId':_0x19d636});const _0x39547a=this['_touchedMarkers']['get'](_0x39ee61),_0x498e08=_0x39547a['range'],_0x5799ca=_0x593e6f['newRange'];null==_0x498e08&&null==_0x5799ca||_0x498e08&&_0x5799ca&&_0x498e08['isEqual'](_0x5799ca)?this['_touchedMarkers']['delete'](_0x593e6f['name']):_0x39547a['userId']=_0x19d636;}}function P(_0x31bf1){const _0x3baf66=new _0x305e8f();_0x3baf66['rootName']=_0x31bf1['rootName'];for(const _0x47fd71 of _0x31bf1['getChildren']()){const _0x37c9f8=_0x47fd71['_clone'](!0x0);_0x3baf66['_appendChild'](_0x37c9f8);}return _0x3baf66;}function N(_0x320876,_0x52cf20){return'elementEnd'==_0x320876['type']?_0x52cf20['createPositionAt'](_0x320876['item'],'end'):_0x52cf20['createPositionBefore'](_0x320876['item']);}function E(_0x3a3969,_0x551d22){return'elementStart'==_0x3a3969['type']?_0x551d22['createPositionAt'](_0x3a3969['item'],0x0):_0x551d22['createPositionAfter'](_0x3a3969['item']);}